[{"title":"Docker + Nginxéƒ¨ç½²å‰ç«¯é¡¹ç›®","url":"/2024/05/10/Docker-Nginx%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE/","content":"åç«¯éƒ¨ç½²å¯ä»¥æŸ¥çœ‹ï¼šGitHub Actions &amp; Dockerå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½² | Jinâ€™s Blog (isjinhu.github.io)\n\n\nDocker + Nginxéƒ¨ç½²å‰ç«¯é¡¹ç›®æ­¤å¤„çœç•¥Dockerå®‰è£…æ­¥éª¤ã€‚\nsudo docker run --rm hello-world # ä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥æµ‹è¯•dockeræ˜¯å¦å®‰è£…æˆåŠŸ\n\nStep 1: æ‹‰å–Nginxé•œåƒdocker pull nginx # æ‹‰å–é•œåƒï¼Œæ²¡æœ‰æŒ‡å®šç‰ˆæœ¬ä¼šé»˜è®¤ä¸‹è½½æœ€æ–° \n\nStep 2: åˆ›å»ºæŒ‚è½½ç›®å½•# æ³¨æ„å½“å‰è·¯å¾„åˆ‡æ¢mkdir -p nginx/htmlmkdir -p nginx/logsmkdir -p nginx/confcd nginxchomd 777 html logs conf\n\nStep 3: å¯åŠ¨ä¸€ä¸ªä¸æŒ‚è½½çš„å®¹å™¨docker run -d --name nginx -p 1000:80 nginx\n\n\n--name nginxï¼šæŒ‡å®šå®¹å™¨åç§°\n-p 1000:80 æ˜ å°„ç«¯å£ï¼ˆå®¿ä¸»æœº:å®¹å™¨ï¼‰\nè¿™é‡Œå¯ä»¥è‡ªé€‰ç«¯å£ï¼Œä½¿ç”¨lsof -i:1000æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨\n\n\n-d å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ\n\nStep 4: æ‹·è´å®¹å™¨å†…é»˜è®¤é…ç½®docker cp nginx:/etc/nginx/nginx.conf nginx/conf/nginx.confdocker cp nginx:/etc/nginx/conf.d nginx/conf/conf.ddocker cp nginx:/usr/share/nginx/html nginx/\n\nStep 5: åœæ­¢ã€åˆ é™¤å®¹å™¨docker stop nginx # åœæ­¢å®¹å™¨docker rm nginx # åˆ é™¤å®¹å™¨docker ps -a # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨\n\nStep 6: éƒ¨ç½²å‰ç«¯é¡¹ç›®\nå°†å‰ç«¯é¡¹ç›®ç›®å½•ï¼ˆvueé¡¹ç›®buildåçš„distç›®å½•ï¼‰ä¸Šä¼ è‡³nginx/htmlç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹nginx/conf.d/default.confæ–‡ä»¶ã€‚\n\nå†…å®¹å¯ä»¥å‚è€ƒï¼Œå…¶ä¸­proxy_passè®°å¾—ä¿®æ”¹ä¸ºå¯¹åº”éƒ¨ç½²çš„åç«¯åœ°å€ï¼Œlistenä¸ºå‰ç«¯çš„ç«¯å£ã€‚\n  server {    listen 1001;    location / {        root /usr/share/nginx/html/hmdp;    }    error_page   500 502 503 504  /50x.html;    location = /50x.html {        root   /usr/share/nginx/html;    }    location /api {        default_type  application/json;        #internal;        keepalive_timeout   30s;        keepalive_requests  1000;        #æ”¯æŒkeep-alive        proxy_http_version 1.1;        rewrite /api(/.*) $1 break;        proxy_pass_request_headers on;        #more_clear_input_headers Accept-Encoding;        proxy_next_upstream error timeout;        proxy_pass http://127.0.0.1:8081;        # proxy_pass http://backend;    }}# upstream backend {#     server 127.0.0.1:80 max_fails=5 fail_timeout=10s weight=1;#     server 127.0.0.1:8082 max_fails=5 fail_timeout=10s weight=1;# }\n\nStep 7: è¿è¡Œé•œåƒï¼Œå…¶ä¸­-pæŒ‡å®šå¯¹åº”çš„ç«¯å£æ˜ å°„ã€‚docker run \\                  -p 1000:80 \\-p 1001:1001 \\--name nginx \\-v /home/ubuntu/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \\-v /home/ubuntu/nginx/conf/conf.d:/etc/nginx/conf.d \\-v /home/ubuntu/nginx/logs:/var/log/nginx \\-v /home/ubuntu/nginx/html:/usr/share/nginx/html \\-d nginx:latest\n\n","categories":["Docker"],"tags":["Docker"]},{"title":"GitHub Actions & Dockerå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²","url":"/2024/05/10/GitHub-Actions-Docker%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/","content":"å…³äºä½¿ç”¨GitHub Actions å’Œ Dockeréƒ¨ç½²SpringBootåç«¯é¡¹ç›®ã€‚\n\n\nGitHub Actions + Dockerå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²å¯ä»¥å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªæ•™ç¨‹ï¼šGitHub Actionså·¥ä½œæµè‡ªåŠ¨åŒ–çš„å…¥é—¨æ ¸å¿ƒ_å“”å“©å“”å“©_bilibili\nSpringBootå¤šç¯å¢ƒåˆ‡æ¢\nå‚è€ƒ: 31 SpringBootå¤šç¯å¢ƒçš„åˆ‡æ¢(ç”Ÿäº§ç¯å¢ƒã€å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒ)_spring bootç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒ-CSDNåšå®¢\n\nStep 1: åœ¨resources/ä¸‹åˆ›å»ºapplication-dev.yamlå’Œapplication-prouct.yamlæ–‡ä»¶ï¼Œåˆ†åˆ«è¡¨ç¤ºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚\nStep 2: åœ¨ä¸¤ä»½é…ç½®æ–‡ä»¶ä¸­åˆ†åˆ«è‡ªå®šä¹‰é…ç½®ï¼Œä¾‹å¦‚ï¼š\n\n\nStep 3: åœ¨application.yamlæ–‡ä»¶ä¸­å¼•ç”¨ï¼š\n\n\nStep 4: æ¿€æ´»é…ç½®æ–‡ä»¶ï¼š\n\né…ç½®æ–‡ä»¶ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šspring.profiles.active=dev\nè™šæ‹Ÿæœºå‚æ•°ï¼šåœ¨VM optionsæŒ‡å®š -Dspring.profiles.active=dev\nå‘½ä»¤è¡Œå‚æ•°ï¼šjava -jar xxx.jar â€“spring.profiles.active=dev\n\nIDEAä¸­ä½¿ç”¨ç¬¬äºŒç§å³å¯ï¼Œéƒ¨ç½²æ—¶ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šã€‚\nDockerfileæ–‡ä»¶ç¼–å†™åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»ºDockerfileï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nFROM fabric8/java-alpine-openjdk11-jreENV TZ=Asia/ShanghaiRUN rm -f /etc/localtime \\&amp;&amp; ln -sv /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\&amp;&amp; echo \"Asia/Shanghai\" &gt; /etc/timezoneCOPY target/*.jar /app.jarENTRYPOINT [\"java\",\"-jar\",\"/app.jar\", \"--spring.profiles.active=product\"]\n\næ³¨æ„ï¼šæœ€åä¸€è¡ŒæŒ‡å®šäº†é…ç½®æ–‡ä»¶ã€‚\nworkflowæ–‡ä»¶ç¼–å†™ä»¥ä¸‹ä¸¤ç§æ–¹å¼äºŒé€‰ä¸€å³å¯ã€‚\nä½¿ç”¨GitHubæä¾›çš„Ubuntuç¯å¢ƒåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»º./github/workflows/delpoy.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n# ä½¿ç”¨Github Actionsè‡ªåŠ¨éƒ¨ç½²Spring Booté¡¹ç›®åˆ°æœåŠ¡å™¨name: Deploy With Dockeron:  push:    branches: [ master ]jobs:  build:    name: Buildå·¥ä½œ    runs-on: ubuntu-latest # ä½¿ç”¨GitHubæä¾›çš„Ubuntuç¯å¢ƒ    steps:      - name: è¯»å–ä»“åº“å†…å®¹        uses: actions/checkout@v4      - name: è®¾ç½®Javaç¯å¢ƒ        uses: actions/setup-java@v4        with:          java-version: 11          distribution: 'adopt'          cache: 'maven'      #      - name: ç¼“å­˜Mavenä¾èµ–      #        uses: actions/cache@v3      #        with:      #          path: ~/.m2/repository      #          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}      #          restore-keys: |      #            ${{ runner.os }}-maven-      - name: ç¼–è¯‘æ‰“åŒ…        run: mvn package -Dmaven.test.skip=true      - name: ç™»å½•åˆ°DockerHub        uses: docker/login-action@v3        with:          username: ${{ secrets.DOCKER_USERNAME }}          password: ${{ secrets.DOCKER_PASSWORD }}      - name: æ„å»ºDockeré•œåƒ        uses: docker/build-push-action@v5        with:          context: .          file: ./Dockerfile          push: true          tags: ${{ secrets.DOCKER_USERNAME }}/project-name:latest      - name: éƒ¨ç½²åˆ°æœåŠ¡å™¨        uses: appleboy/ssh-action@master        with:          host: ${{ secrets.SERVER_HOST }}          username: ${{ secrets.SERVER_USERNAME }}          port: ${{ secrets.SERVER_PORT }}          password: ${{ secrets.SERVER_PASSWORD }}          script: |            sh /path/to/delpoy.sh\n\nproject-nameè®°å¾—æ›¿æ¢ä¸ºè‡ªå·±çš„é¡¹ç›®åç§°\nå…¶ä¸­deploy.shè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼ˆè®°å¾—æ›¿æ¢{{}}ä¸­å†…å®¹ï¼Œç«¯å£è®°å¾—æŒ‰éœ€ä¿®æ”¹ï¼‰ï¼š\ndocker pull {{username}}/{{project-name}}:latestdocker tag docker.io/{{username}}/{[project-name]}:latest {{project-name}}:latestdocker rm -f {{project-name}}docker run --name {{project-name}} -p 1002:8081 -d {{project-name}}:latestdocker image prune -af\n\nDockerHubè®°å¾—å…ˆæ³¨å†Œè´¦å·ã€‚å¦‚æœDockerhubä¸Šä¼ çš„æ˜¯ç§å¯†é•œåƒï¼Œè®°å¾—åœ¨æœåŠ¡å™¨ç™»å½•è´¦å·ï¼šdocker login\nåœ¨GitHubé¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ymlæ–‡ä»¶ä¸­çš„secretsï¼Œä½ç½®å¦‚ä¸‹ï¼š\n\n\nä½¿ç”¨è‡ªå·±çš„æœåŠ¡å™¨Step 1: æ·»åŠ Runner\n\n\nStep 2: é€‰æ‹©æœåŠ¡å™¨å¯¹åº”ç³»ç»Ÿï¼ŒæŒ‰ç…§æ‰€ç¤ºæ­¥éª¤åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå³å¯ï¼š\n\n\n\nå…¶ä¸­ï¼Œè¿è¡Œconfig.shè„šæœ¬è®°å¾—ä½¿ç”¨érootç”¨æˆ·ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚\nå…¶æ¬¡./run.shå‘½ä»¤æ”¹ä¸ºnohup ./run.sh &amp;åœ¨åå°ä¸æŒ‚æ–­è¿è¡Œã€‚\n\nStep 3: åœ¨æœåŠ¡å™¨è®°å¾—å®‰è£…mavenå’ŒJava\nsudo apt updatesudo apt install mavenmvn --version # éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ\n\n\nå‚è€ƒï¼šå¦‚ä½•åœ¨ Ubuntu 20.04 ä¸Šå®‰è£… Apache Maven-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘\n\nStep 4: åœ¨é¡¹ç›®åˆ›å»ºworkflowæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nname: Deploy With Runneron:  push:    branches: [ master ]jobs:  build:    name: Buildå·¥ä½œ    runs-on: self-hosted # ä½¿ç”¨è‡ªå·±çš„æœåŠ¡å™¨    steps:      - name: è¯»å–ä»“åº“å†…å®¹        uses: actions/checkout@v4      - name: è®¾ç½®Javaç¯å¢ƒ        run: |          pwd          java --version          mvn --version      - name: ç¼–è¯‘æ‰“åŒ…        run: mvn package -Dmaven.test.skip=true      - name: æ„å»ºDockeré•œåƒ        run: |          docker build -f Dockerfile -t {{project-name}}:latest .      - name: éƒ¨ç½²åˆ°æœåŠ¡å™¨        run: |          docker rm -f {{project-name}          docker run -d --name {{project-name}} -p 1002:8080 {{project-name}}:latest          docker ps\n\nç«¯å£è®°å¾—æŒ‰éœ€ä¿®æ”¹\nå¼€å§‹è‡ªåŠ¨åŒ–éƒ¨ç½²å°†ä»£ç æäº¤åˆ°GitHubåï¼Œåœ¨GitHubçš„Actionså°±èƒ½å‘ç°æ­£åœ¨è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚\nå‚è€ƒ\nä½¿ç”¨Github Actions + Docker éƒ¨ç½²Spring Bootåº”ç”¨ - æ˜é‡‘\nGithub Actionså®ç°Spring Bootè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆç¬¬äºŒå¼¹ï¼‰_JavaGPTçš„æŠ€æœ¯åšå®¢_51CTOåšå®¢\n\n","tags":["Docker","GitHub"]},{"title":"GitHub Pages & Hexo æ­å»ºåšå®¢","url":"/2023/08/28/GitHub-Pages-Hexo-%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/","content":"å…³äºå¦‚ä½•ä½¿ç”¨GitHub Pageså’ŒHexoæ­å»ºä¸ªäººåšå®¢å¹¶è¿›è¡Œå†™ä½œï¼ˆä½¿ç”¨Keepä¸»é¢˜ï¼‰ã€‚\n\n\nGitHub Pages &amp; Hexo æ­å»ºåšå®¢Hexo å®‰è£…ä¸é…ç½®\nHexo å®‰è£…ä¸é…ç½® | Easy Hexo ğŸ‘¨â€ğŸ’»\n\n\nç¡®è®¤æœ¬åœ°å·²ç»å®‰è£… Git å’Œ Node.js\nå®‰è£…hexo: npm install -g hexo-cli\nåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åå¾€è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å®‰è£…Hexo\né…ç½® Hexoï¼Œå…¶é…ç½®æ–‡ä»¶ä¸º_config.ymlï¼šé…ç½® Hexo | Easy Hexo ğŸ‘¨â€ğŸ’»\n\nnpm install -g hexo-cli # å®‰è£…Hexomkdir mkdir &lt;your_blog_name&gt;  # å»ºç«‹ä½ çš„ç½‘ç«™æ ¹ç›®å½•ï¼Œåå­—å¯ä»¥è‡ªå·±ä¿®æ”¹hexo init &lt;your_blog_name&gt; # å¾€è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å®‰è£…Hexo\n\nä½¿ç”¨GitHub Pageséƒ¨ç½²åˆ°GitHub\néƒ¨ç½² Hexo | Easy Hexo ğŸ‘¨â€ğŸ’»\n\nStep 1: åˆ›å»ºä¸€ä¸ªä»“åº“ï¼š&lt;username&gt;.github.io\nStep 2: åœ¨ï¼ˆ&lt;username&gt;.github.ioï¼‰å®‰è£…éƒ¨ç½²æ’ä»¶\nnpm install hexo-deployer-git --savenpm install hexo-server --save\n\nStep 3: éƒ¨ç½²åˆ° GitHub\nhexo clean &amp;&amp; hexo d -g\n\nGitHubä¿å­˜åšå®¢é¡¹ç›®çš„æºä»£ç # æœ¬åœ°åšå®¢é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œgit initgit checkout -b hexo # åˆ‡æ¢åˆ†æ”¯git add .git commit -m \"init\"git remote add origin git@github.com:isJinHu/isjinhu.github.io.git # æ·»åŠ è¿œç¨‹ä»“åº“git remote -vgit push origin hexo:hexo # pushåˆ°è¿œç¨‹ä»“åº“çš„hexoåˆ†æ”¯\n\nKeepä¸»é¢˜å®‰è£…ä¸é…ç½®\nhome_article | Keep ä¸»é¢˜ä½¿ç”¨æ‰‹å†Œ &amp;&amp; XPoet's Blog\n\nStep 1: å®‰è£…Keepä¸»é¢˜\ncd &lt;your_blog_name&gt;npm install hexo-theme-keep\n\nStep 2: ä½¿ç”¨Keepä¸»é¢˜ï¼šåœ¨ Hexo é…ç½®æ–‡ä»¶ _config.yml ä¸­å°† theme è®¾ç½®ä¸º keepã€‚\ntheme: keep\n\nStep 3ï¼šé…ç½®Keepä¸»é¢˜ï¼šåœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª _config.keep.ymlæ–‡ä»¶ï¼Œå‚ç…§æ–‡æ¡£è¿›è¡Œé…ç½®ï¼šbase_info | Keep ä¸»é¢˜ä½¿ç”¨æŒ‡å—\nå…¶ä»–ï¼š\n\nå¯èƒ½ç”¨åˆ°çš„å‘½ä»¤ï¼š\nnpm install hexo-theme-keep # å®‰è£… keep ä¸»é¢˜npm install hexo-filter-mathjax # å®‰è£…æ˜¾ç¤ºæ•°å­¦å…¬å¼çš„æ’ä»¶npm install hexo-generator-searchdb # å®‰è£…ç«™å†…æœç´¢æ’ä»¶npm install hexo-wordcount # å®‰è£…ç»Ÿè®¡å­—æ•°æ’ä»¶hexo new page about # hexoåˆ›å»ºé¡µé¢å‘½ä»¤ï¼Œä½¿ç”¨è¯¥å‘½ä»¤åˆ›å»ºabouté¡µé¢ã€‚\næ•°å­¦å…¬å¼ | Keep ä¸»é¢˜ä½¿ç”¨æŒ‡å—ï¼šå»ºè®®å¼€å¯ã€‚\n\né…ç½®æ—¶çš„å›¾æ ‡æ–‡ä»¶å¯ä»¥æ”¾åœ¨ source/imagesæ–‡ä»¶å¤¹ä¸­ã€‚\n\nGitalkè®¾ç½®ï¼šcomment | Keep ä¸»é¢˜ä½¿ç”¨æŒ‡å—\n\n\né»˜è®¤åšå®¢æ¨¡æ¿åœ¨ scaffolds/post.mdä¸­å¯ä»¥è®¾ç½®é»˜è®¤æ¨¡æ¿ï¼Œæ¯”å¦‚é»˜è®¤æ‰“å¼€å…¬å¼æ¸²æŸ“ç­‰ã€‚\ntitle: {{ title }}date: {{ date }}mathjax: truetags:\n\nå›¾ç‰‡æ’å…¥ï¼šç»“åˆTyporaStep 1ï¼šä¿®æ”¹ _config.ymlæ–‡ä»¶\npost_asset_folder: true # å°†è¿™ä¸ªé…ç½®é¡¹æ”¹ä¸ºtrueï¼Œè¿™æ ·hexo new â€œpostname\"æ—¶ä¼šåˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹marked:  prependRoot: true  postAsset: true\n\nStep 2ï¼šå®‰è£…æ’ä»¶\nnpm install hexo-asset-img --savenpm install hexo-renderer-marked --save\n\nStep 3: è®¾ç½®Typoraæ’å…¥å›¾ç‰‡æ—¶è·¯å¾„ï¼š${filename}\nHexo deployå¤±è´¥ï¼Ÿ\næ‰§è¡ŒHexo dæŠ¥é”™Spawn failedï¼Œ ä»¥åŠOpenSSL SSL_read: Connection was reset, errno 10054_copying files from extend dirsâ€¦warning: in the w_Candle_lightçš„åšå®¢-CSDNåšå®¢\n\nhexo config deploy.repository git@github.com:isjinhu/isjinhu.github.io.git\n\nå…¶ä»–é“¾æ¥Hexo å¦‚ä½•éšè—æ–‡ç«  - yangstar - åšå®¢å›­\n","tags":["GitHub","Hexo"]},{"title":"JVMç¬”è®°","url":"/2024/07/05/JVM%E7%AC%94%E8%AE%B0/","content":"\nJVMåŸºç¡€æ¦‚å¿µï¼šJVMå†…å­˜åŒºåŸŸåˆ’åˆ†ã€ç±»åŠ è½½æœºåˆ¶\nåƒåœ¾å›æ”¶ï¼šJVMåƒåœ¾å›æ”¶ç®—æ³•\nJVMå®æˆ˜ï¼šOOMç§»é™¤åœºæ™¯åˆ†æ&amp;å·¥å…·&amp;æ’æŸ¥æ€è·¯\nè¿›é˜¶ï¼šJMMï¼Œä»å­—èŠ‚ç å±‚é¢åˆ†æJavaåŸºç¡€ç‰¹æ€§&amp;å¹¶å‘é—®é¢˜ï¼ŒJava Agent\n\n\n\nJVMåŸºç¡€\nJavaä¸ºä»€ä¹ˆéœ€è¦JVMï¼Ÿ\nJVMè¿è¡ŒåŸç†ï¼Ÿ\nJavaä»£ç å¦‚ä½•è¿è¡Œï¼Ÿ\n\nJVMå’ŒOSå…³ç³»\nå¯¹äºå…¶ä»–è¯­è¨€ï¼Œæ¯”å¦‚C++ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶åï¼ŒOSå°±èƒ½ç›´æ¥è¯†åˆ«è¿è¡Œï¼Œè¿™æ ·å¯¹äºä¸åŒå¹³å°ï¼Œéœ€è¦å†æ¬¡ç¼–è¯‘ã€‚\nä½†æ˜¯Javaåœ¨javacç¼–è¯‘ä¸ºäºŒè¿›åˆ¶å­—èŠ‚ç æ–‡ä»¶åï¼Œéœ€è¦JVMå»æ‰§è¡Œå…¶ä¸­çš„æŒ‡ä»¤ï¼ŒJVMä¸OSäº¤äº’ï¼Œä»è€Œå®ç°è·¨å¹³å°ã€‚\nå› æ­¤ï¼ŒJVMå¯ä»¥çœ‹æˆä¸€ç§OSï¼Œå­—èŠ‚ç æ–‡ä»¶æ˜¯æ±‡ç¼–è¯­è¨€ï¼ŒJavaè¯­è¨€ä¼šç¼–è¯‘ï¼ˆç¿»è¯‘ï¼‰æˆè¿™ç§æ±‡ç¼–ï¼Œå†äº¤ç»™JVMè¿è¡Œã€‚\n"},{"title":"LeetCodeåˆ·é¢˜ç¬”è®°: å›æº¯&è´ªå¿ƒ&åŠ¨æ€è§„åˆ’","url":"/2024/05/14/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0-%E5%9B%9E%E6%BA%AF-%E8%B4%AA%E5%BF%83-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/","content":"å›æº¯å°±æ˜¯æš´åŠ›ç©·ä¸¾ï¼Œæ˜¯ä¸€ç§æœç´¢æ–¹å¼ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ä»ä¸€ä¸ªåˆå§‹çŠ¶æ€å‡ºå‘ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢éå†æ‰€æœ‰å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼ˆè§£ç©ºé—´ï¼‰ï¼Œå¦‚æœç¡®å®šæŸç§æ–¹æ¡ˆä¸å¯è¡Œå°±å›æº¯åˆ°ä¸Šä¸€æ­¥é‡æ–°æœç´¢ã€‚ä¸€èˆ¬ç”¨æ¥è§£å†³ç»„åˆé—®é¢˜ï¼ˆæ— åºï¼‰ã€å­é›†é—®é¢˜ï¼ˆæ— åºï¼‰ã€æ’åˆ—é—®é¢˜ï¼ˆæœ‰åºï¼‰ã€å­—ç¬¦ä¸²åˆ‡å‰²é—®é¢˜ã€æ£‹ç›˜é—®é¢˜ç­‰ã€‚\nè´ªå¿ƒç®—æ³•çš„æ€æƒ³æ˜¯åœ¨æ¯ä¸ªå†³ç­–é˜¶æ®µï¼Œé€‰æ‹©å±€éƒ¨æœ€ä¼˜è§£ï¼Œä»¥æ­¤è·å–å…¨å±€æœ€ä¼˜è§£ã€‚\nåŠ¨æ€è§„åˆ’\n\n\nå›æº¯å›æº¯å°±æ˜¯æš´åŠ›ç©·ä¸¾ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ä»ä¸€ä¸ªåˆå§‹çŠ¶æ€å‡ºå‘ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢éå†æ‰€æœ‰å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼ˆè§£ç©ºé—´ï¼‰ï¼Œå½“é‡åˆ°æ­£è§£å°±è®°å½•ï¼Œç›´åˆ°æ‰¾åˆ°è§£æˆ–è€…å°è¯•æ‰€æœ‰å¯èƒ½åç»ˆæ­¢ã€‚\nå¯ä»¥è§£å†³ï¼š\n\nç»„åˆé—®é¢˜ï¼šnä¸ªæ•°å–æ»¡è¶³è§„åˆ™çš„kä¸ªæ•°\nå­é›†é—®é¢˜ï¼šnä¸ªæ•°æœ‰å¤šå°‘ç¬¦åˆæ¡ä»¶çš„å­é›†\næ’åˆ—é—®é¢˜ï¼šnä¸ªæ•°æŒ‰ä¸€å®šè§„åˆ™çš„å…¨æ’åˆ—æœ‰å‡ ç§æ–¹å¼\nå­—ç¬¦ä¸²åˆ†å‰²é—®é¢˜ï¼šå­—ç¬¦ä¸²æŒ‰ä¸€å®šè§„åˆ™æœ‰å‡ ç§åˆ‡å‰²æ–¹å¼\næ£‹ç›˜é—®é¢˜ï¼šNçš‡åã€æ•°ç‹¬ç­‰\n\nä¸€èˆ¬éœ€è¦è€ƒè™‘3ä¸ªé—®é¢˜ï¼š\n\nè·¯å¾„ï¼šå·²ç»åšå‡ºçš„é€‰æ‹©\né€‰æ‹©åˆ—è¡¨ï¼šå¯ä»¥åšçš„é€‰æ‹©\nç»“æŸæ¡ä»¶ï¼šæ— æ³•å†åšé€‰æ‹©çš„æ¡ä»¶\n\nresult = []def backtrack(path, choices):    if æ»¡è¶³ç»“æŸæ¡ä»¶:        result.add(path)        return    for choice in choices:        è®°å½•é€‰æ‹©        backtrack(path, choices)        æ’¤é”€é€‰æ‹©\n\n\nå›æº¯ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶ | labuladong çš„ç®—æ³•ç¬”è®°\nä»£ç éšæƒ³å½•\n\nç»„åˆé—®é¢˜77. ç»„åˆ - ä¸­ç­‰77. ç»„åˆ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\næ€è·¯ï¼š\n46. å…¨æ’åˆ— - ä¸­ç­‰46. å…¨æ’åˆ—\næ€è·¯ï¼šè¿™é¢˜æ˜¯å›æº¯çš„ç»å…¸åº”ç”¨ã€‚æŒ‰æˆ‘ä»¬è‡ªå·±ç©·ä¸¾å…¨æ’åˆ—çš„æ€è·¯ï¼Œé¦–å…ˆé€‰æ‹©ç¬¬ä¸€ä¸ªçš„æ•°å­—ï¼Œä¸‹ä¸€ä¸ªçš„æ•°å­—åœ¨å‰©ä¸‹çš„æ•°å­—åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œè¿™æ ·ç›´åˆ°æ‰€æœ‰çš„æ•°å­—éƒ½é€‰å®Œã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®°å½•ä¹‹å‰å·²ç»é€‰è¿‡çš„æ•°å­—ï¼Œä»æ²¡é€‰è¿‡çš„æ•°å­—ä¸­è¿›è¡Œå½“å‰é˜¶æ®µçš„é€‰æ‹©ã€‚\nå…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç¬¬0ä¸ªä½ç½®å¼€å§‹ï¼Œé€’å½’é€‰æ‹©æ¯ä¸ªæ²¡è¢«é€‰è¿‡çš„æ•°å­—ï¼Œé€‰æ‹©å®Œæ‰€æœ‰å…ƒç´ å°±å›æº¯æ’¤é”€é€‰æ‹©ã€‚\nclass Solution {    List&lt;List&lt;Integer&gt;&gt; res;    List&lt;Integer&gt; path;    int[] nums;    public List&lt;List&lt;Integer&gt;&gt; permute(int[] nums) {        this.res=new ArrayList&lt;&gt;();        this.path=new ArrayList&lt;&gt;(nums.length);        this.nums=nums;        dfs(0, new boolean[nums.length]);        return res;    }    private void dfs(int i, boolean[] used){        if(nums.length==i){            res.add(new ArrayList&lt;&gt;(path));            return;        }        for(int j=0;j&lt;nums.length;j++){            if(!used[j]){                path.add(nums[j]); // é€‰æ‹©                used[j]=true;                dfs(i+1, used); // é€’å½’                path.remove(i); // æ’¤é”€é€‰æ‹©                used[j]=false;            }        }    }}\n\n78. å­é›† - ä¸­ç­‰78. å­é›†\næ€è·¯ï¼šå¯¹äºæ¯ä¸ªæ•°å­—æˆ‘ä»¬å¯ä»¥é€‰æˆ–è€…ä¸é€‰ï¼Œå› æ­¤ç¬¬iå±‚å°±æ˜¯å¯¹ä¼šæœ‰å¯¹ç¬¬iä¸ªæ•°å­—é€‰æˆ–è€…ä¸é€‰ä¸¤ä¸ªé€‰é¡¹ã€‚\nclass Solution {    List&lt;List&lt;Integer&gt;&gt; res;    List&lt;Integer&gt; path;    int[] nums;    public List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums) {        this.res=new ArrayList&lt;&gt;();        this.path=new ArrayList&lt;&gt;();        this.nums=nums;        dfs(0);        return res;    }    private void dfs(int i){        if(i==nums.length){            res.add(new ArrayList&lt;&gt;(path));            return;        }        // é€‰è¿™ä¸ªæ•°å­—        path.add(nums[i]);        dfs(i+1);\t\t// ä¸é€‰è¿™ä¸ªæ•°å­—        path.remove(path.size()-1);         dfs(i+1);        // æ’¤é”€é€‰æ‹©ï¼šéœ€è¦æ³¨æ„è¿™é‡Œçš„æ’¤é”€é€‰æ‹©åªçš„æ˜¯å¯¹è¿™ä¸ªæ•°å­—çš„é€‰æ‹©è¡Œä¸ºæœ¬èº«ï¼ˆå›åˆ°çš„æ˜¯é€‰æ‹©ä¸Šä¸€ä¸ªæ•°å­—çš„çŠ¶æ€ï¼‰ï¼Œè€Œä¸æ˜¯é€‰è¿™ä¸ªæ•°å­—    }}\n\n39. ç»„åˆæ€»å’Œ - ä¸­ç­‰39. ç»„åˆæ€»å’Œ\næ€è·¯ï¼šå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥\nè´ªå¿ƒ45. è·³è·ƒæ¸¸æˆ II - åŠ›æ‰£ï¼ˆLeetCodeï¼‰","tags":["LeetCode","ç®—æ³•"]},{"title":"LeetCodeåˆ·é¢˜ç¬”è®°ï¼šæ•°ç»„&åŒæŒ‡é’ˆ","url":"/2024/05/28/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%9A%E6%95%B0%E7%BB%84-%E5%8F%8C%E6%8C%87%E9%92%88/","content":"\n\nåŒæŒ‡é’ˆåŒæŒ‡é’ˆç®—æ³•æ˜¯ä¸€ç±»ç”¨2ä¸ªæŒ‡é’ˆéå†æ•°ç»„æˆ–é“¾è¡¨çš„ç®—æ³•ï¼Œé€šå¸¸ç”¨æ¥è§£å†³åœ¨æ•°æ®ä¸­è¿›è¡Œæœç´¢ã€æ’åºã€åŒ¹é…çš„é—®é¢˜ã€‚\nåŒå‘åŒæŒ‡é’ˆåŒå‘åŒæŒ‡é’ˆä¹Ÿå¯å«å¿«æ…¢åŒæŒ‡é’ˆï¼Œä¸€èˆ¬æ…¢æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼Œå¿«æŒ‡é’ˆåˆ™ç§»åŠ¨ä¸¤æ­¥æˆ–æ›´å¤šæ­¥ã€‚\nä¸€èˆ¬ç”¨æ¥è§£å†³é“¾è¡¨é—®é¢˜ã€‚\nç”¨åœ¨æ•°ç»„ä¸­ï¼Œå¯ä»¥è§£å†³æœ‰åºæ•°ç»„è¦æ ¹æ®ä¸€å®šæ¡ä»¶åŸåœ°åˆ›å»ºæ–°æ•°ç»„è¿™æ ·ä¸€ç±»é—®é¢˜ã€‚å…·ä½“æ¥è¯´ï¼Œå¿«æŒ‡é’ˆæŒ‡å‘æ—§æ•°ç»„å½“å‰éå†ä½ç½®ï¼Œæ…¢æŒ‡é’ˆæŒ‡å‘æ–°æ•°ç»„é•¿åº¦ï¼ˆä¸‹ä¸€ä¸ªå…ƒç´ è¦æ”¾ç½®çš„ä½ç½®ï¼‰ï¼Œæ ¹æ®æ–°æ—§æ•°ç»„åˆ¤æ–­å¿«æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ æ˜¯å¦å¯ä»¥åŠ å…¥æ–°æ•°ç»„ï¼Œå¦‚88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ã€27. ç§»é™¤å…ƒç´ ã€26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ã€80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II ã€‚\n88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„\n\nè¾“å…¥ï¼šnums1 = [1,2,3,0,0,0], m = 3, nums2 = [2,5,6], n = 3è¾“å‡ºï¼š[1,2,2,3,5,6]è§£é‡Šï¼šéœ€è¦åˆå¹¶ [1,2,3] å’Œ [2,5,6] ã€‚åˆå¹¶ç»“æœæ˜¯ [1,2,2,3,5,6] ï¼Œå…¶ä¸­æ–œä½“åŠ ç²—æ ‡æ³¨çš„ä¸º nums1 ä¸­çš„å…ƒç´ ã€‚\n\nä»ä¸¤ä¸ªæ•°ç»„æœ«å°¾éå†ï¼Œæ…¢æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ å°†è¦æ”¾ç½®çš„ä½ç½®ï¼Œ2ä¸ªå¿«æŒ‡é’ˆåˆ†åˆ«æŒ‡å‘2ä¸ªæ•°ç»„å½“å‰æ­£åœ¨å¯¹æ¯”çš„å…ƒç´ ï¼Œå“ªä¸ªæ•°å­—æ›´å¤§å°±æ”¾ç½®åœ¨æ…¢æŒ‡é’ˆæŒ‡å‘ä½ç½®ï¼Œç„¶åå†ç§»åŠ¨æŒ‡é’ˆã€‚\nclass Solution {    public void merge(int[] nums1, int m, int[] nums2, int n) {        // åŒå‘åŒæŒ‡é’ˆ        int slow=m+n-1;        int fast1=m-1, fast2=n-1;        while(fast1&gt;=0&amp;&amp;fast2&gt;=0){            if(nums1[fast1]&gt;nums2[fast2]){                nums1[slow--]=nums1[fast1--];            }else{                nums1[slow--]=nums2[fast2--];            }        }        while(fast2&gt;=0){            nums1[slow--]=nums2[fast2--];        }    }}\n\n27. ç§»é™¤å…ƒç´ 27. ç§»é™¤å…ƒç´ \n\nè¾“å…¥ï¼šnums = [3,2,2,3], val = 3è¾“å‡ºï¼š2, nums = [2,2,,]è§£é‡Šï¼šä½ çš„å‡½æ•°å‡½æ•°åº”è¯¥è¿”å› k = 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚ä½ åœ¨è¿”å›çš„ k ä¸ªå…ƒç´ ä¹‹å¤–ç•™ä¸‹äº†ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼ˆå› æ­¤å®ƒä»¬å¹¶ä¸è®¡å…¥è¯„æµ‹ï¼‰\n\næ…¢æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ å°†è¦æ”¾ç½®çš„ä½ç½®ï¼Œå¿«æŒ‡é’ˆæŒ‡å‘å½“å‰éå†ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªæ•°æ˜¯è¦ç§»é™¤çš„å…ƒç´ ï¼Œå¿«æŒ‡é’ˆåç§»ï¼Œå¦åˆ™å°†å…¶å¤åˆ¶åˆ°æ…¢æŒ‡é’ˆæŒ‡å‘ä½ç½®å†åç§»ã€‚\nclass Solution {    public int removeElement(int[] nums, int val) {        // åŒå‘åŒæŒ‡é’ˆ        int slow=0, fast=0;        while(fast&lt;nums.length){            if(nums[fast]!=val){                nums[slow++]=nums[fast];            }            fast++;        }        return slow;    }}\n\n26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹\n\nè¾“å…¥ï¼šnums = [1,1,2]è¾“å‡ºï¼š2, nums = [1,2,_]è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2 ï¼Œå¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 2 ã€‚ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\n\næ…¢æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ å°†è¦æ”¾ç½®çš„ä½ç½®ï¼ˆç›¸å½“äºæ–°æ•°ç»„é•¿åº¦ä½ç½®ï¼‰ï¼Œå¿«æŒ‡é’ˆæŒ‡å‘å½“å‰éå†ä½ç½®ã€‚\nå¦‚æœå¿«æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ å·²ç»åœ¨æ–°æ•°ç»„ä¸­slow-1ä½ç½®å‡ºç°ï¼Œé‚£ä¹ˆå°±é‡å¤ï¼Œå¿«æŒ‡é’ˆç›´æ¥åç§»ï¼Œå¦åˆ™å¤åˆ¶åˆ°æ…¢æŒ‡é’ˆä½ç½®å†åç§»ã€‚\nclass Solution {    public int removeDuplicates(int[] nums) {        // åŒå‘åŒæŒ‡é’ˆ        if(nums.length==1) return 1;        int slow=1, fast=1;        while(fast&lt;nums.length){            if(nums[fast]==nums[slow-1]){                fast++;            }else{                nums[slow++]=nums[fast++];            }        }        return slow;    }}\n\n80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II\n\nè¾“å…¥ï¼šnums = [1,1,1,2,2,3]è¾“å‡ºï¼š5, nums = [1,1,2,2,3]è§£é‡Šï¼šå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = 5, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 1, 2, 2, 3ã€‚ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ \n\næ…¢æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ å°†è¦æ”¾ç½®çš„ä½ç½®ï¼ˆç›¸å½“äºæ–°æ•°ç»„é•¿åº¦ä½ç½®ï¼‰ï¼Œå¿«æŒ‡é’ˆæŒ‡å‘å½“å‰éå†ä½ç½®ã€‚\nå¦‚æœå½“å‰å…ƒç´ ä¸æ–°æ•°ç»„çš„å€’æ•°ç¬¬äºŒä¸ªæ•°ä¸€æ ·ï¼Œè¯´æ˜æ–°æ•°ç»„å·²å‡ºç°2æ¬¡è¯¥æ•°ï¼Œè¯¥æ•°ä¸éœ€è¦åŠ å…¥æ–°æ•°ç»„ï¼Œå¿«æŒ‡é’ˆç›´æ¥åç§»ï¼Œå¦åˆ™å¤åˆ¶åå†åç§»ã€‚\nclass Solution {    public int removeDuplicates(int[] nums) {        if(nums.length&lt;3) return nums.length;        int slow=2, fast=2;        while(fast&lt;nums.length){            if(nums[slow-2]!=nums[fast]){                nums[slow++]=nums[fast++];            }else{                fast++;            }        }        return slow;    }}\n\næ•°ç»„169. å¤šæ•°å…ƒç´ -æ‘©å°”æŠ•ç¥¨169. å¤šæ•°å…ƒç´  - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\nå¯»æ‰¾é•¿åº¦ä¸ºnçš„æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å¤šæ•°å…ƒç´ ã€‚\n\nè¾“å…¥ï¼šnums = [3,2,3]è¾“å‡ºï¼š3\n\næ‘©å°”æŠ•ç¥¨\n\nè®°å¤šæ•°å…ƒç´ çš„ç¥¨ä¸º1ï¼Œå…¶ä»–ä¸º-1ï¼Œé‚£ä¹ˆæ‰€æœ‰æ•°å­—çš„ç¥¨æ•°å’Œä¸€å®š&gt;0\nè‹¥å‰aä¸ªæ•°å­—ç¥¨æ•°å’Œ=0ï¼Œé‚£ä¹ˆå‰©ä½™çš„n-aä¸ªæ•°å­—çš„ç¥¨æ•°å’Œä¸€å®š&gt;0ï¼Œå¤šæ•°å…ƒç´ ä¾æ—§ä¸å˜ã€‚\n\nå› æ­¤ï¼Œç¥¨æ•°å’Œ=0æ—¶ï¼Œå¯ä»¥ç¼©å°å‰©ä½™æ•°ç»„åŒºé—´ã€‚å‡è®¾é¦–ä¸ªå…ƒç´ nä¸ºå¤šæ•°å…ƒç´ xï¼Œé‚£ä¹ˆå½“n=xæ—¶ï¼ŒæŠµæ¶ˆçš„å…ƒç´ ä¸­ä¸€åŠæ˜¯å¤šæ•°å…ƒç´ xï¼›å½“n!=xæ—¶ï¼ŒæŠµæ¶ˆçš„å¤šæ•°å…ƒç´ å¯èƒ½æ˜¯0-ä¸€åŠã€‚å› æ­¤æœ€åä¸€è½®å‡è®¾çš„å¿…å®šæ˜¯å¤šæ•°å…ƒç´ ã€‚\n\nå¤šæ•°å…ƒç´ ä¸ºtä¸ªï¼Œt&gt;n/2ï¼Œ2(n-t)&lt;nï¼Œå› æ­¤æŠµæ¶ˆåˆ°æœ€åå‰©ä½™çš„å¿…å®šæ˜¯å¤šæ•°å…ƒç´ ä¸ºé¦–çš„æ•°ç»„ã€‚\n\nclass Solution {    public int majorityElement(int[] nums) {        int x=0, votes=0;        for(int n:nums){            if(votes==0) x=n;            votes += n == x ? 1 : -1;        }        return x;    }}\n\n189. è½®è½¬æ•°ç»„ #todo æ—‹è½¬å¹³ç§»ç±»189. è½®è½¬æ•°ç»„ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\né¦–å…ˆåè½¬æ•´ä¸ªæ•°ç»„ï¼Œç„¶ååè½¬å‰kä¸ªï¼Œåè½¬ån-kä¸ªï¼Œå°±æ˜¯è½®è½¬åçš„æ•°ç»„ã€‚\næ³¨æ„ï¼šk=k%nã€‚\nclass Solution {    public void rotate(int[] nums, int k) {        int n=nums.length;        k=k%n;        if(k==0) return;        reverse(nums, 0, nums.length-1);        reverse(nums, 0, k-1);        reverse(nums, k, nums.length-1);    }    private void reverse(int[] nums, int start, int end){        while(start&lt;end){            int tmp=nums[start];            nums[start++]=nums[end];            nums[end--]=tmp;        }    }}\n\n121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\nåªèƒ½åœ¨æŸå¤©ä¹°å…¥ï¼Œæœªæ¥æŸå¤©å–å‡ºã€‚\n\nè¾“å…¥ï¼š[7,1,5,3,6,4]è¾“å‡ºï¼š5è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = 6-1 = 5 ã€‚     æ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 = 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ï¼›åŒæ—¶ï¼Œä½ ä¸èƒ½åœ¨ä¹°å…¥å‰å–å‡ºè‚¡ç¥¨ã€‚\n\næ€è·¯ï¼šåªè¦çŸ¥é“è¿™å¤©ä¹‹å‰æœ€ä½æ˜¯å¤šå°‘ï¼Œå°±æ˜¯å½“æ—¥æœ€å¤§åˆ©æ¶¦ï¼Œå› æ­¤éå†æ—¶è®°å½•minä»¥åŠå½“å‰åˆ©æ¶¦ï¼Œæ›´æ–°æœ€å¤§åˆ©æ¶¦å³å¯ã€‚\nclass Solution {    public int maxProfit(int[] prices) {        int minPrice=prices[0];        int res=0;        for(int i=1;i&lt;prices.length;i++){            res=Math.max(res, prices[i]-minPrice);            minPrice=Math.min(minPrice, prices[i]);        }        return res;    }}\n\n122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II - åŠ›æ‰£ï¼ˆLeetCodeï¼‰åœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ/æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ æœ€å¤š åªèƒ½æŒæœ‰ ä¸€è‚¡ è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶ååœ¨ åŒä¸€å¤© å‡ºå”®ã€‚\n\nè¾“å…¥ï¼šprices = [7,1,5,3,6,4]è¾“å‡ºï¼š7è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5 - 1 = 4 ã€‚     éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6 - 3 = 3 ã€‚     æ€»åˆ©æ¶¦ä¸º 4 + 3 = 7 ã€‚\n\næ€è·¯ï¼šåªè¦æ¯”å‰ä¸€å¤©é«˜ï¼Œå°±ä¹°å…¥ï¼Œç¬¬äºŒå¤©å°±å–å‡ºã€‚\nclass Solution {    public int maxProfit(int[] prices) {        int res=0;        for(int i=1;i&lt;prices.length;i++){            if(prices[i]&gt;prices[i-1]){                res+=prices[i]-prices[i-1];            }        }        return res;    }}\n\n55. è·³è·ƒæ¸¸æˆ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰- åŠ¨æ€è§„åˆ’ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ nums ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ ç¬¬ä¸€ä¸ªä¸‹æ ‡ ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚\nåˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ï¼Œå¦‚æœå¯ä»¥ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚\n\nè¾“å…¥ï¼šnums = [2,3,1,1,4]è¾“å‡ºï¼štrueè§£é‡Šï¼šå¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»ä¸‹æ ‡ 0 åˆ°è¾¾ä¸‹æ ‡ 1, ç„¶åå†ä»ä¸‹æ ‡ 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ã€‚\n\næ€è·¯ï¼šå¯¹äºæ¯ä¸ªä½ç½®\n","tags":["LeetCode","ç®—æ³•"]},{"title":"LeetCodeåˆ·é¢˜ç¬”è®°ï¼šæ ˆ&å•è°ƒæ ˆ&å•è°ƒé˜Ÿåˆ—","url":"/2024/05/11/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%9A%E6%A0%88-%E5%8D%95%E8%B0%83%E6%A0%88-%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/","content":"æ ˆæ˜¯ä¸€ç§ã€Œå…ˆè¿›åå‡ºã€çš„æ•°æ®ç»“æ„ã€‚å•è°ƒæ ˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ˆï¼Œåœ¨æ»¡è¶³ã€Œå…ˆè¿›åå‡ºã€è§„åˆ™åŸºç¡€ä¸Šï¼ŒåŒæ—¶æ»¡è¶³ã€Œä»æ ˆåº•åˆ°æ ˆé¡¶çš„å…ƒç´ å•è°ƒé€’å¢/å‡ã€ï¼Œå› æ­¤ä¹Ÿåˆ†ä¸ºå•è°ƒé€’å¢æ ˆï¼Œå•è°ƒé€’å‡æ ˆã€‚\nå•è°ƒæ ˆç”¨æ¥è§£å†³ä¸‹ä¸€ä¸ªæ›´å¤§/å°å…ƒç´ ã€ä¸Šä¸€ä¸ªæ›´å¤§/å°å…ƒç´ è¿™ä¸€ç±»çš„å…¸å‹é—®é¢˜ã€‚æ¯”å¦‚739. æ¯æ—¥æ¸©åº¦ï¼Œ84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ï¼Œ42. æ¥é›¨æ°´éƒ½æ˜¯è¿™ç±»é—®é¢˜ã€‚\né˜Ÿåˆ—æ˜¯ä¸€ç§ã€Œå…ˆè¿›å…ˆå‡ºã€çš„æ•°æ®ç»“æ„ã€‚å•è°ƒé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œåœ¨æ»¡è¶³ã€Œå…ˆè¿›å…ˆå‡ºã€è§„åˆ™åŸºç¡€ä¸Šï¼ŒåŒæ—¶æ»¡è¶³ã€Œä»é˜Ÿé¦–åˆ°é˜Ÿå°¾çš„å…ƒç´ å•è°ƒé€’å¢/å‡ã€ã€‚\nå•è°ƒé˜Ÿåˆ—ç”¨æ¥è§£å†³æ»‘åŠ¨çª—å£å†…çš„æœ€å¤§/å°å€¼ã€ä¸­ä½æ•°çš„åŠ¨æ€æŸ¥è¯¢è¿™ä¸€ç±»é—®é¢˜ã€‚æ¯”å¦‚239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼ã€‚\n\n\nå•è°ƒæ ˆè¿™é‡Œä»¥å•è°ƒé€’å‡æ ˆä¸ºä¾‹ï¼Œå¯ä»¥è§£å†³æ±‚ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ é—®é¢˜ã€‚\nå•è°ƒé€’å‡æ ˆçš„æ€æƒ³æ˜¯ï¼šåªæœ‰æ¯”æ ˆé¡¶å…ƒç´ å°çš„å…ƒç´ æ‰èƒ½ç›´æ¥è¿›æ ˆï¼Œå¦åˆ™éœ€è¦å°†æ ˆä¸­æ›´å°çš„å…ƒç´ å‡ºæ ˆã€‚è¿™æ ·ï¼Œå½“å…ƒç´ å‡ºæ ˆæ—¶ï¼Œå°±æ‰¾åˆ°äº†ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€‚\n739. æ¯æ—¥æ¸©åº¦ - ä¸­ç­‰739. æ¯æ—¥æ¸©åº¦ï¼šç»™å®šä¸€ä¸ªè¡¨ç¤ºæ¯æ—¥æ¸©åº¦çš„æ•´æ•°æ•°ç»„ï¼Œæ±‚å¯¹äºæ¯å¤©åœ¨ç¬¬å‡ å¤©åæ¸©åº¦ä¼šæ¯”è¿™å¤©æ›´é«˜ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¡«0ã€‚\n\nè¾“å…¥: temperatures = [73,74,75,71,69,72,76,73]\nè¾“å‡º: [1,1,4,2,1,1,0,0]\n\næ€è·¯ï¼šæ±‚çš„æ˜¯ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ çš„ç´¢å¼•è·ç¦»ï¼Œç”¨å•è°ƒé€’å‡æ ˆï¼Œæ ˆä¸­è®°å½•çš„å®é™…ä¸Šæ˜¯è¿˜æ²¡ç®—å‡ºã€Œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€çš„æ•°å­—ä¸‹æ ‡ã€‚\næ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œæ¯ä¸ªå…ƒç´ åªè¿›å‡ºæ ˆä¸€æ¬¡ã€‚\nclass Solution {    public int[] dailyTemperatures(int[] temperatures) {        int length=temperatures.length;        int[] res=new int[length];        Deque&lt;Integer&gt; stack=new ArrayDeque&lt;&gt;(); // å•è°ƒæ ˆ        for(int i=0;i&lt;length;i++){            while(!stack.isEmpty()&amp;&amp;temperatures[i]&gt;temperatures[stack.peekLast()]){                int j=stack.pollLast();                res[j]=i-j;            }            stack.offerLast(i);        }        // while(!stack.isEmpty()){        //     res[stack.pollLast()]=0;        // }        return res;    }}\n\n84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ - å›°éš¾84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ï¼šç»™å®šæŸ±çŠ¶å›¾ä¸­æ¯ä¸ªæŸ±å­é«˜åº¦ï¼Œæ±‚èƒ½å‹¾å‹’å‡ºçš„çŸ©å½¢æœ€å¤§é¢ç§¯ã€‚\n\n\n\nè¾“å…¥ï¼šheights = [2,1,5,6,2,3]\nè¾“å‡ºï¼š10\nè§£é‡Šï¼šæœ€å¤§çš„çŸ©å½¢ä¸ºå›¾ä¸­çº¢è‰²åŒºåŸŸï¼Œé¢ç§¯ä¸º 10\n\næ€è·¯1ï¼šæƒ³è¦ä»¥æŸä¸ªæŸ±å­ä¸ºé«˜ï¼Œé‚£ä¹ˆå¿…é¡»çŸ¥é“è¿™ä¸ªæŸ±å­å·¦å³ä¾§æ›´çŸ®æŸ±å­çš„ä¸‹æ ‡ï¼Œå³è¦æ±‚æ›´å°å…ƒç´ ä¸‹æ ‡ã€‚å› æ­¤ç”¨2ä¸ªå•è°ƒé€’å¢æ ˆï¼Œåˆ†åˆ«æ±‚ä¸Š/ä¸‹ä¸€ä¸ªæ›´å°å…ƒç´ å¹¶ä¿å­˜ï¼Œæœ€ååœ¨éå†æ±‚é¢ç§¯å³å¯ã€‚\næ€è·¯2ï¼šè®¡ç®—å³ä¾§æ›´çŸ®æŸ±å­çš„ä¸‹æ ‡æ—¶ï¼Œå•è°ƒæ ˆç”¨äºç»´æŠ¤æ²¡æœ‰æ‰¾åˆ°å³ä¾§æ›´çŸ®æŸ±å­çš„æŸ±å­ç´¢å¼•ï¼Œå½“æŸä¸ªå…ƒç´ å‡ºæ ˆæ—¶ï¼Œè¯´æ˜è¿™ä¸ªå…ƒç´ æ‰¾åˆ°å³ä¾§æ›´çŸ®æŸ±å­ï¼ŒåŒæ—¶æ–°çš„æ ˆé¡¶å…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¸€å®šæ˜¯å½“å‰å‡ºæ ˆæŸ±å­å·¦ä¾§æ›´çŸ®çš„æŸ±å­ã€‚ï¼ˆå› ä¸ºå¦‚æœå·¦ä¾§æœ‰æ›´é«˜çš„æŸ±å­ï¼Œéƒ½å·²ç»å‡ºæ ˆï¼Œè€Œæ›´çŸ®çš„æŸ±å­ä¼šç•™åœ¨é‡Œé¢ï¼‰\nclass Solution {    public int largestRectangleArea(int[] heights) {        Deque&lt;Integer&gt; stack=new ArrayDeque&lt;&gt;();        int res=0;        for(int i=0;i&lt;heights.length;i++){            while(!stack.isEmpty()&amp;&amp;heights[i]&lt;heights[stack.peekLast()]){                int curHeight=heights[stack.pollLast()];                int leftIdx=0;                if(!stack.isEmpty()){                    leftIdx=stack.peekLast()+1;                }                int area=curHeight*(i-leftIdx);                res=Math.max(res,area);            }            stack.offerLast(i);        }        while(!stack.isEmpty()){            int curHeight=heights[stack.pollLast()];            int leftIdx=0;            if(!stack.isEmpty()){                leftIdx=stack.peekLast()+1;            }            int area=curHeight*(heights.length-leftIdx);            res=Math.max(res,area);        }        return res;    }}\n\n42. æ¥é›¨æ°´ - å›°éš¾å•è°ƒæ ˆåšæ³•42. æ¥é›¨æ°´\n\n\næ€è·¯ï¼šå½“æˆ‘ä»¬æ‰¾åˆ°å³ä¾§ç¬¬ä¸€ä¸ªæ¯”æŸä¸ªä½ç½®å¤§çš„å…ƒç´ æ—¶ï¼Œè¿™é‡Œå°±èƒ½æ¥æ°´ï¼Œç›¸å½“äºæ¨ªç€è®¡ç®—ã€‚\n\n\nclass Solution {    public int trap(int[] height) {        // å•è°ƒæ ˆåšæ³•        Deque&lt;Integer&gt; stack=new ArrayDeque&lt;&gt;();        int res=0;        for(int i=0;i&lt;height.length;i++){            while(!stack.isEmpty()&amp;&amp;height[stack.peekLast()]&lt;=height[i]){                int curHeight=height[stack.pollLast()];                if(stack.isEmpty()) break;                int left=stack.peekLast();                int h=Math.min(height[left], height[i])-curHeight;                res+=h*(i-left-1);            }            stack.offerLast(i);        }        return res;    }}\n\nåŒæŒ‡é’ˆåšæ³•æ€è·¯ï¼š\n\næŸä¸ªä½ç½®èƒ½æ¥çš„æ°´=min(å·¦è¾¹æŸ±å­çš„æœ€é«˜é«˜åº¦ï¼Œè®°å½•å³è¾¹æŸ±å­çš„æœ€é«˜é«˜åº¦) - å½“å‰æŸ±å­é«˜åº¦ã€‚\nä½¿ç”¨ç›¸å‘åŒæŒ‡é’ˆéå†åˆ†åˆ«è®°å½•å·¦å³ä¸¤ä¾§å½“å‰æœ€å¤§å€¼ï¼Œå…¶ä¸­è¾ƒå°çš„é‚£ä¸ªå°±æ˜¯å…¬å¼ç”¨åˆ°çš„é‚£ä¸ªã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œç©ºé—´å¤æ‚åº¦ï¼šO(1)ã€‚\nclass Solution {    public int trap(int[] height){        // åŒæŒ‡é’ˆåšæ³•: min{lMax, rMax}-h[i], lMax=max{0,...,i}        int res=0;        int left=0, right=height.length-1;        int lMax=height[0], rMax=height[right];        while(left&lt;=right){            if(lMax&lt;rMax){                lMax=Math.max(lMax, height[left]);                res+=lMax-height[left++];            }else{                rMax=Math.max(rMax, height[right]);                res+=rMax-height[right--];            }        }        return res;    }}\n\nå•è°ƒé˜Ÿåˆ—å•è°ƒé˜Ÿåˆ—çš„æ€æƒ³æ˜¯ï¼šåªæœ‰å½“ä¸€ä¸ªå…ƒç´ æ˜¯æœ€å€¼æˆ–è€…å¯èƒ½æˆä¸ºæœ€å€¼æ—¶æ‰ä¿ç•™ï¼Œå¦åˆ™å‡ºé˜Ÿã€‚è¿™æ ·ï¼Œæ¯æ¬¡ç§»åŠ¨çª—å£æ—¶ï¼Œé˜Ÿé¦–å°±æ˜¯å½“å‰çª—å£æœ€å€¼ã€‚\n239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼ - å›°éš¾239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼\n\n\næ€è·¯ï¼šå¯¹äºçª—å£[1 3 -1]ï¼Œå…¶ä¸­3æ˜¯æœ€å¤§å€¼ï¼Œ3ä¹‹å‰çš„æ•°å­—1æ¯”3å°ä¸”æ›´æ—©ç¦»å¼€ï¼Œæ‰€ä»¥æ— è®ºçª—å£å¦‚ä½•ç§»åŠ¨éƒ½ä¸ä¼šæˆä¸ºæœ€å¤§å€¼ï¼Œ3ä¹‹åçš„æ•°å­—-1æ¯”3å°ä½†æ›´æ™šç¦»å¼€ï¼Œå› æ­¤å¯èƒ½æˆä¸ºæœ€å¤§å€¼ã€‚æ¯æ¬¡ç§»åŠ¨æ—¶ï¼Œéœ€è¦åˆ¤æ–­é˜Ÿé¦–çš„æœ€å€¼æ˜¯å¦ç¦»å¼€çª—å£ï¼Œåˆ¤æ–­é˜Ÿå†…çš„æ—§æ•°å­—æ˜¯å¦è¿˜å¯èƒ½æˆä¸ºæ–°çš„æœ€å€¼ï¼Œå¦‚æœæ¯”æ–°æ•°å­—å°å°±ä¸å¯èƒ½ï¼Œéœ€è¦å‡ºé˜Ÿï¼›å¦åˆ™å¯èƒ½ï¼Œä¿ç•™ï¼Œç„¶åå†å°†æ–°æ•°å­—å…¥é˜Ÿã€‚\nclass Solution {    public int[] maxSlidingWindow(int[] nums, int k) {        Deque&lt;Integer&gt; queue=new ArrayDeque&lt;&gt;();        int[] res=new int[nums.length-k+1];        // iæŒ‡å‘å³å°†å…¥æ ˆçš„å…ƒç´ ï¼ŒjæŒ‡å‘å³å°†å‡ºæ ˆçš„å…ƒç´         for(int i=0, j=-k+1;i&lt;nums.length;i++,j++){            // åŠ å…¥æ–°å…ƒç´ ï¼Œè®©çª—å£å¤§å°ä¿æŒä¸ºk            while(!queue.isEmpty()&amp;&amp;queue.peekLast()&lt;nums[i]){                queue.pollLast();            }            queue.offerLast(nums[i]); // å…¥é˜Ÿ            if(j&lt;0) continue;            // è®¡ç®—å½“å‰çª—å£æœ€å€¼            res[j]=queue.peekFirst();            // ç§»åŠ¨çª—å£            if(queue.peekFirst()==nums[j]){                queue.pollFirst();            }        }        return res;    }}\n\næ ˆï¼š394. å­—ç¬¦ä¸²è§£ç 394. å­—ç¬¦ä¸²è§£ç \nclass Solution {    public String decodeString(String s) {        StringBuilder res=new StringBuilder();        int times = 0;        LinkedList&lt;Integer&gt; timesStack=new LinkedList&lt;&gt;();        LinkedList&lt;String&gt; substrStack=new LinkedList&lt;&gt;();        for(int i=0;i&lt;s.length();i++){            char c=s.charAt(i);            if(c&gt;='0'&amp;&amp;c&lt;='9'){                times=times*10+Integer.parseInt(c+\"\");            }else if(c == '['){                timesStack.add(times);                substrStack.add(res.toString());                times=0;                res=new StringBuilder();            }else if(c==']'){                int curTimes=timesStack.pollLast();                StringBuilder str=new StringBuilder();                while(curTimes--!=0) str.append(res);                res=new StringBuilder(substrStack.pollLast()+str);            }else{                res.append(c);            }        }        return res.toString();    }}\n\n","tags":["LeetCode","ç®—æ³•"]},{"title":"Nettyç¬”è®°ï¼šåŸºç¡€æ¦‚å¿µ&æŠ€æœ¯æ¶æ„&æ ¸å¿ƒç»„ä»¶","url":"/2024/07/03/Netty%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/","content":"Nettyæ˜¯å¯¹Java NIOçš„é«˜çº§å°è£…ï¼Œå¤§å¤§ç®€åŒ–äº†ç½‘ç»œåº”ç”¨çš„å¼€å‘ï¼Œå¹¶å¯¹æ‹†åŒ…/ç²˜åŒ…ã€æ•°æ®ç¼–è§£ç ã€TCPæ–­çº¿é‡è¿ç­‰ä¸€ç³»åˆ—é—®é¢˜æä¾›äº†ç°æˆçš„è§£å†³æ–¹æ¡ˆã€‚\nä½œä¸ºä¸€ä¸ªç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œæœ¬æ–‡å°†ä»Nettyçš„åŸºç¡€æ¦‚å¿µã€æŠ€æœ¯æ¶æ„ã€æ ¸å¿ƒç»„ä»¶ç­‰æ–¹é¢å¯¹Nettyè¿›è¡Œå‰–æã€‚\n\n\nåŸºç¡€æ¦‚å¿µä»€ä¹ˆæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ\næ ¹æ®è¿›ç¨‹è®¿é—®èµ„æºç‰¹ç‚¹ï¼Œå¯ä»¥å°†è¿›ç¨‹åˆ†ä¸ºç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¸¤ä¸ªçº§åˆ«ã€‚ç”¨æˆ·æ€è¿è¡Œçš„è¿›ç¨‹åªèƒ½è®¿é—®æœ‰é™çš„èµ„æºï¼Œè¿›è¡Œå—é™çš„æ“ä½œï¼›è€Œå†…æ ¸æ€è¿è¡Œçš„è¿›ç¨‹å¯ä»¥è®¿é—®æ‰€æœ‰èµ„æºï¼Œè¿›è¡Œä»»æ„æ“ä½œï¼ŒåŒ…æ‹¬è¯»å†™ç£ç›˜ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚\nI/Oæ“ä½œæ˜¯ä»€ä¹ˆï¼ŸIOæ“ä½œæ˜¯æŒ‡è®¡ç®—æœºä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œæ•°æ®äº¤æ¢çš„è¿‡ç¨‹ï¼Œå¯ä»¥åˆ†ä¸º2ä¸ªé˜¶æ®µï¼š\n\nI/Oè°ƒç”¨é˜¶æ®µï¼šç”¨æˆ·è¿›ç¨‹å‘å†…æ ¸å‘èµ·ç³»ç»Ÿè°ƒç”¨ã€‚\nI/Oæ‰§è¡Œé˜¶æ®µï¼šå†…æ ¸ç­‰å¾…I/Oè¯·æ±‚å¤„ç†å®Œæˆè¿”å›ã€‚è¯¥é˜¶æ®µåˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼šé¦–å…ˆç­‰å¾…æ•°æ®å°±ç»ªï¼Œå¹¶å†™å…¥å†…æ ¸ç¼“å†²åŒºï¼›éšåå°†å†…æ ¸ç¼“å†²åŒºæ•°æ®æ‹·è´è‡³ç”¨æˆ·æ€ç¼“å†²åŒºã€‚\n\n\n\n5ç§I/Oæ¨¡å‹åœ¨ã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ä¸­ï¼Œæ ¹æ®ä¸åŒçš„äº¤æ¢æ•°æ®æ–¹å¼ï¼Œå°†I/Oæ¨¡å‹åˆ†ä¸º5ç§ï¼š\n\nåŒæ­¥é˜»å¡I/Oï¼ˆBlocking I/Oï¼‰\n\nç”¨æˆ·è¿›ç¨‹å‘èµ·I/Oè¯·æ±‚åï¼Œä¸€ç›´é˜»å¡ç­‰å¾…å†…æ ¸è¿”å›æ•°æ®ã€‚\nè¿™æ ·ä¼šå¯¼è‡´å•çº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªI/Oè¯·æ±‚ï¼Œæ— æ³•åŒæ—¶å¤„ç†å¤šä¸ªI/Oè¯·æ±‚ã€‚å› æ­¤ï¼Œæƒ³è¦æé«˜ååé‡ï¼Œåªèƒ½é€šè¿‡å¢åŠ çº¿ç¨‹æ•°ï¼Œä½†çº¿ç¨‹æ•°è¿‡å¤šä¼šå¯¼è‡´çº¿ç¨‹åˆ‡æ¢å¼€é”€å¢å¤§ã€‚\n\n\nåŒæ­¥éé˜»å¡I/Oï¼ˆNon-blocking I/Oï¼‰\n\nç”¨æˆ·è¿›ç¨‹å‘èµ·I/Oè¯·æ±‚åï¼Œä¸ä¼šé˜»å¡ç­‰å¾…å†…æ ¸è¿”å›æ•°æ®ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ã€‚\nä¹‹åç”¨æˆ·è¿›ç¨‹éœ€è¦é€šè¿‡è½®è¯¢çš„æ–¹å¼ï¼Œä¸æ–­æŸ¥è¯¢å†…æ ¸æ˜¯å¦æœ‰æ•°æ®è¿”å›ã€‚\nä¼˜ç‚¹æ˜¯ä¸ä¼šé˜»å¡ï¼Œä½†éœ€è¦ä¸æ–­è½®è¯¢ï¼Œå­˜åœ¨å¤§é‡ä¸Šä¸‹æ–‡åˆ‡æ¢æ“ä½œï¼Œä¼šå¯¼è‡´CPUèµ„æºæµªè´¹ã€‚\n\n\nI/Oå¤ç”¨ï¼ˆI/O Multiplexingï¼‰\n\nå¤šè·¯å¤ç”¨æŠ€æœ¯é€šè¿‡select/poll/epollç­‰ç³»ç»Ÿè°ƒç”¨ï¼Œå®ç°äº†ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªI/Oæ“ä½œï¼Œå³é€šè¿‡ä¸€ä¸ªçº¿ç¨‹ç›‘å¬å¤šä¸ªChannelï¼Œå½“æŸä¸ªChannelæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œæ‰ä¼šè§¦å‘äº‹ä»¶ã€‚\nä¸NIOç±»ä¼¼ï¼Œå‘èµ·I/Oè¯·æ±‚åï¼Œä¸ä¼šé˜»å¡ç­‰å¾…å†…æ ¸è¿”å›æ•°æ®ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ï¼Œä¹‹åç”¨æˆ·çº¿ç¨‹é€šè¿‡selectè°ƒç”¨è·å–å¤šä¸ªæ•°æ®é€šé“çš„æ•°æ®çŠ¶æ€ï¼Œå†è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œã€‚\nä¼˜ç‚¹æ˜¯ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªIOé€šé“ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼Œæé«˜äº†ç³»ç»ŸIOååé‡ï¼Œé€‚åˆå¤§é‡è¿æ¥ä½†æ•°æ®é‡å°çš„åœºæ™¯ã€‚\n\n\nä¿¡å·é©±åŠ¨I/Oï¼ˆSignal Driven I/Oï¼‰\n\nç”¨æˆ·è¿›ç¨‹å‘èµ·I/Oè¯·æ±‚åï¼Œä¼šç»™å¯¹åº”socketæ³¨å†Œä¸€ä¸ªä¿¡å·å‡½æ•°ï¼Œç„¶åè¿”å›ã€‚å†…æ ¸åœ¨æ•°æ®å‡†å¤‡å¥½åï¼Œå‘é€SIGIOä¿¡å·é€šçŸ¥ç”¨æˆ·è¿›ç¨‹è¿›è¡Œæ•°æ®è¯»å–ã€‚\n\n\nå¼‚æ­¥I/Oï¼ˆAsynchronous I/Oï¼‰\n\nç”¨æˆ·è¿›ç¨‹å‘èµ·I/Oè¯·æ±‚åï¼Œä¸ä¼šé˜»å¡ç­‰å¾…å†…æ ¸è¿”å›æ•°æ®ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ï¼Œä¹‹åå†…æ ¸ä¼šåœ¨æ•°æ®å‡†å¤‡å¥½åï¼Œå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œå†é€šçŸ¥ç”¨æˆ·è¿›ç¨‹æ•°æ®å·²å‡†å¤‡å¥½ã€‚\nä¸NIOåŒºåˆ«åœ¨äºï¼ŒNIOæ˜¯ç”¨æˆ·è¿›ç¨‹ä¸»åŠ¨è½®è¯¢å†…æ ¸æ˜¯å¦æœ‰æ•°æ®è¿”å›ï¼Œè€Œå¼‚æ­¥I/Oæ˜¯å†…æ ¸ä¸»åŠ¨é€šçŸ¥ç”¨æˆ·è¿›ç¨‹æ•°æ®å·²å‡†å¤‡å¥½ã€‚\nä¸ä¿¡å·é©±åŠ¨I/Oç›¸æ¯”ï¼Œä¿¡å·é©±åŠ¨I/Oæ˜¯ç”¨æˆ·è¿›ç¨‹å»å¤åˆ¶æ•°æ®ï¼Œè€Œå¼‚æ­¥I/Oä¸éœ€è¦ç”¨æˆ·è¿›ç¨‹å‚ä¸æ•°æ®å¤åˆ¶ï¼Œä¼šç›´æ¥å°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œæ˜¯å®Œå…¨å¼‚æ­¥éé˜»å¡çš„ã€‚\nä¼˜ç‚¹æ˜¯ç”¨æˆ·è¿›ç¨‹å®Œå…¨ä¸ä¼šé˜»å¡ï¼Œä¸”ä¸éœ€è¦ç”¨æˆ·è¿›ç¨‹è½®è¯¢ï¼Œé€‚åˆå¤§é‡è¿æ¥ä¸”æ•°æ®é‡å¤§çš„åœºæ™¯ã€‚\n\n\n\næ€ä¹ˆåŒºåˆ†åŒæ­¥éé˜»å¡å’Œå¤šè·¯å¤ç”¨è¿™ä¸¤ç§IOæ¨¡å¼å‘¢ï¼Ÿ\nä¸ªäººç†è§£æ˜¯ï¼Œä»æ¦‚å¿µè§’åº¦çœ‹ï¼Œä¸åŒçš„IOæ¨¡å‹çš„åŒºåˆ«åœ¨äºæ•°æ®äº¤æ¢è¿‡ç¨‹ã€‚åŒæ­¥éé˜»å¡ä¾§é‡äºçº¿ç¨‹ä¸æ–­è½®è¯¢ï¼Œå¤šè·¯å¤ç”¨åˆ™ä¾§é‡äºä¸€ä¸ªçº¿ç¨‹ç›‘å¬å¤šä¸ªChannelã€‚\nä½†æ˜¯ä»Java NIOæ¥çœ‹ï¼ŒNIOåŒ…çš„ä¸‰å¤§ç»„ä»¶Bufferã€Channelã€Selectorå°±æ˜¯å¯¹å¤šè·¯å¤ç”¨çš„å°è£…å®ç°ã€‚\nä¸ºä»€ä¹ˆIOå¤šè·¯å¤ç”¨æ¯”å¤šçº¿ç¨‹æ›´é«˜æ•ˆï¼Ÿ\nå¤šè·¯å¤ç”¨æŠ€æœ¯é€šè¿‡ä¸€ä¸ªçº¿ç¨‹ç›‘å¬å¤šä¸ªChannelï¼Œå½“æŸä¸ªChannelæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œæ‰ä¼šè§¦å‘äº‹ä»¶ã€‚è¿™æ ·ï¼Œä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªI/Oè¯·æ±‚ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼Œæé«˜äº†ç³»ç»ŸIOååé‡ã€‚\nä½†æ ¸å¿ƒåœ¨äºå¤šè·¯å¤ç”¨å°†å¯¹å¤šä¸ªChannelçš„è½®è¯¢ç›‘å¬äº¤ç»™äº†å†…æ ¸ï¼Œå‡å°‘äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€‚\nä¸ºä»€ä¹ˆIOå¤šè·¯å¤ç”¨å¯ä»¥å¢åŠ ååé‡ï¼Ÿ\nååé‡çš„æå‡ä¸€æ˜¯ä½“ç°åœ¨å°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¿æ¥ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼›äºŒæ˜¯ä½“å‡å°‘äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œä¸‰æ˜¯Nettyè¿˜é€šè¿‡é«˜æ•ˆçš„äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œé€šè¿‡å¼‚æ­¥ï¼ˆå¤šçº¿ç¨‹ï¼‰å¹¶è¡Œå¤„ç†æ‹†åˆ†ä»»åŠ¡ï¼Œæé«˜äº†ç³»ç»Ÿçš„ååé‡ã€‚\n\nå…³äºselect/poll/epollçš„åŒºåˆ«ä»¥åŠå…¶ä»–å†…å®¹ï¼Œå¯ä»¥å‚è€ƒï¼šã€Redisã€‘IOå¤šè·¯å¤ç”¨æœºåˆ¶_redis ioå¤šè·¯å¤ç”¨-CSDNåšå®¢å¼‚æ­¥IOä¸å›è°ƒ - Evil_XJZ - åšå®¢å›­\n\nLinks\nlinuxå’Œunixä¸­çš„IOæ¨¡å‹æ€»ç»“ - ä¹å· - åšå®¢å›­\n\n"},{"title":"Hello World","url":"/2023/08/28/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n","tags":["Hexo"]},{"title":"LeetCodeåˆ·é¢˜ç¬”è®°ï¼šæ»‘åŠ¨çª—å£","url":"/2024/09/03/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%9A%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/","content":"æ»‘åŠ¨çª—å£ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ä¸¤ä¸ªæŒ‡é’ˆæ¥å®šä¹‰ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡åŠ¨æ€è°ƒæ•´çª—å£å¤§å°å’Œä½ç½®æ¥æ±‚è§£é—®é¢˜ã€‚\né€šå¸¸ç”¨äºè§£å†³å­æ•°ç»„ã€å­ä¸²ã€å­åºåˆ—ç›¸å…³é—®é¢˜ï¼Œæ¯”å¦‚ï¼šæœ€å¤§æœ€å°å­æ•°ç»„ï¼ˆæœ€å¤§å­æ•°ç»„å’Œï¼‰ã€ï¼ˆåŒ…å«æ‰€æœ‰å­—ç¬¦çš„/æ— é‡å¤å­—ç¬¦çš„ï¼‰å­å­—ç¬¦ä¸²ã€å®šé•¿å­æ•°ç»„çš„æœ€å¤§/å°å€¼ã€æ»‘åŠ¨çª—å£å¹³å‡å€¼ã€‚\n\n\næ»‘åŠ¨çª—å£å­ä¸²3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² - ä¸­ç­‰3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚\nclass Solution {    public int lengthOfLongestSubstring(String s) {        int res=0;        int start=0, end=0; // æ»‘åŠ¨çª—å£æŒ‡é’ˆ        Map&lt;Character, Integer&gt; lastOccuredMap=new HashMap&lt;&gt;(); // è®°å½•å­—ç¬¦å‡ºç°ä½ç½®+1,é‡åˆ°é‡å¤çª—å£èµ·ç‚¹åº”ç§»åŠ¨åˆ°æ­¤å¤„        while(end&lt;s.length()){            char c=s.charAt(end++); // çª—å£æ‰©å¤§            if(lastOccuredMap.containsKey(c)){ // æ˜¯å¦éœ€è¦ç¼©å°                start=Math.max(start, lastOccuredMap.get(c));            }            res=Math.max(res, end-start);            lastOccuredMap.put(c, end);        }        return res;    }}\n\n438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ -ä¸­ç­‰ ï¼ˆç±»ä¼¼æœ€å°è¦†ç›–å­ä¸²ï¼‰438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\nç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ pï¼Œæ‰¾åˆ° s ä¸­æ‰€æœ‰ p çš„ å¼‚ä½è¯ çš„å­ä¸²ï¼Œè¿”å›è¿™äº›å­ä¸²çš„èµ·å§‹ç´¢å¼•ã€‚ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚\nclass Solution {    public List&lt;Integer&gt; findAnagrams(String s, String p) {        List&lt;Integer&gt; res=new ArrayList&lt;&gt;();        if(s.length()&lt;p.length()) return res;        Map&lt;Character, Integer&gt; targetMap=new HashMap&lt;&gt;(); // ç›®æ ‡çª—å£        Map&lt;Character, Integer&gt; windowMap=new HashMap&lt;&gt;(); // æ»‘åŠ¨çª—å£è®°å½•        for(char c:p.toCharArray()){            targetMap.put(c, targetMap.getOrDefault(c,0)+1);        }        int start=0, end=0; // æ»‘åŠ¨çª—å£æŒ‡é’ˆ        int count=0;        while(end&lt;s.length()){            char cur=s.charAt(end++);            if(targetMap.containsKey(cur)){                windowMap.put(cur, windowMap.getOrDefault(cur, 0)+1);                if(windowMap.get(cur).equals(targetMap.get(cur))) count++; // æ³¨æ„ï¼šè¿™é‡Œæ˜¯Integerï¼Œä¸€å®šå¾—ç”¨equalsï¼Œè€Œä¸æ˜¯==            }            while(targetMap.size()==count){                if(end-start==p.length()){                    res.add(start);                }                char expired=s.charAt(start++);                if(targetMap.containsKey(expired)){                    if(targetMap.get(expired).equals(windowMap.get(expired))) count--;                    windowMap.put(expired, windowMap.get(expired)-1);                }            }        }        return res;    }}\n\n567. å­—ç¬¦ä¸²çš„æ’åˆ— - ä¸­ç­‰567. å­—ç¬¦ä¸²çš„æ’åˆ— - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\nclass Solution {    public boolean checkInclusion(String s1, String s2) {        if(s1.length()&gt;s2.length()) return false;        Map&lt;Character, Integer&gt; targetMap=new HashMap&lt;&gt;(); // ç›®æ ‡çª—å£        Map&lt;Character, Integer&gt; windowMap=new HashMap&lt;&gt;(); // æ»‘åŠ¨çª—å£è®°å½•        for(char c:s1.toCharArray()){            targetMap.put(c, targetMap.getOrDefault(c,0)+1);        }        int start=0, end=0; // æ»‘åŠ¨çª—å£æŒ‡é’ˆ        int count=0;        while(end&lt;s2.length()){            char cur=s2.charAt(end++);            if(targetMap.containsKey(cur)){                windowMap.put(cur, windowMap.getOrDefault(cur, 0)+1);                if(windowMap.get(cur).equals(targetMap.get(cur))) count++; // æ³¨æ„ï¼šè¿™é‡Œæ˜¯Integerï¼Œä¸€å®šå¾—ç”¨equalsï¼Œè€Œä¸æ˜¯==                while(count==targetMap.size()){                    if(end-start==s1.length()){return true;}                    char expired=s2.charAt(start++);                    if(windowMap.get(expired).equals(targetMap.get(expired))) count--;                    windowMap.put(expired, windowMap.get(expired)-1);                }            }else{                windowMap=new HashMap&lt;&gt;();                count=0;                start=end;            }        }        return false;    }}\n\n76. æœ€å°è¦†ç›–å­ä¸² - å›°éš¾76. æœ€å°è¦†ç›–å­ä¸² - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\nclass Solution {    public String minWindow(String s, String t) {        if(s.length()&lt;t.length()) return \"\";        Map&lt;Character, Integer&gt; targetMap=new HashMap&lt;&gt;(); // ç›®æ ‡çª—å£        Map&lt;Character, Integer&gt; windowMap=new HashMap&lt;&gt;(); // æ»‘åŠ¨çª—å£è®°å½•        for(char c:t.toCharArray()){            targetMap.put(c, targetMap.getOrDefault(c,0)+1);        }        int start=0, end=0; // æ»‘åŠ¨çª—å£æŒ‡é’ˆ        int minLen=s.length()+1, minStart=0, minEnd=0;        int count=0;        while(end&lt;s.length()){            char cur=s.charAt(end++);            if(targetMap.containsKey(cur)){                windowMap.put(cur, windowMap.getOrDefault(cur, 0)+1);                if(windowMap.get(cur).equals(targetMap.get(cur))) count++; // æ³¨æ„ï¼šè¿™é‡Œæ˜¯Integerï¼Œä¸€å®šå¾—ç”¨equalsï¼Œè€Œä¸æ˜¯==            }            while(targetMap.size()==count){                if(end-start&lt;minLen){                    minLen=end-start;                    minStart=start;                    minEnd=end;                }                char expired=s.charAt(start++);                if(targetMap.containsKey(expired)){                    if(targetMap.get(expired).equals(windowMap.get(expired))) count--;                    windowMap.put(expired, windowMap.get(expired)-1);                }            }        }        return s.substring(minStart, minEnd);    }}\n\n","tags":["LeetCode","ç®—æ³•"]},{"url":"/2024/07/15/JUC%E7%AC%94%E8%AE%B0/","content":"JUCåŒ…å¤§è‡´å¯ä»¥åˆ†ä¸º5ä¸ªéƒ¨åˆ†ï¼šExecutorï¼ˆçº¿ç¨‹æ± ï¼‰ã€Collectionsï¼ˆå¹¶å‘é›†åˆï¼‰ã€Atomicï¼ˆåŸå­å˜é‡ç±»ï¼‰ã€Lockï¼ˆé”ï¼‰ã€Toolsï¼ˆåŒæ­¥è¾…åŠ©å·¥å…·ç±»ï¼‰\n\n\n0. Javaçº¿ç¨‹åŸºç¡€çº¿ç¨‹å®ç°æ–¹å¼Javaåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ¬è´¨åªæœ‰ä¸€ç§ï¼šæ„é€ ä¸€ä¸ªThreadç±»å®ä¾‹ã€‚\nå¸¸è§å®ç°æ–¹å¼çš„åŒ…æ‹¬1ï¼‰ç»§æ‰¿Threadç±»é‡å†™runæ–¹æ³•ï¼Œè°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ï¼›2ï¼‰å®ç°Runnableæ¥å£ï¼Œä¼ å…¥Threadå®ä¾‹ä¸­ï¼›3ï¼‰ä½¿ç”¨Callableé…åˆFutureåˆ›å»ºæœ‰è¿”å›å€¼çš„çº¿ç¨‹ï¼›4ï¼‰åˆ›å»ºçº¿ç¨‹æ± \n\nç›´æ¥è°ƒç”¨Threadç±»çš„runæ–¹æ³•ä¼šåœ¨åŸçº¿ç¨‹ä¸­æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œstartæ–¹æ³•æ‰ä¼šè°ƒç”¨nativeæ–¹æ³•å»åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œrunæ–¹æ³•ã€‚\n\nä¸ºä»€ä¹ˆå®ç°Runnableæ¥å£æ¯”ç»§æ‰¿Threadç±»å®ç°çº¿ç¨‹å¥½ï¼Ÿ\nå®ç°äº†Runnableå’ŒThreadç±»çš„è§£è€¦ï¼ŒRunnableè´Ÿè´£å®šä¹‰æ‰§è¡Œå†…å®¹ï¼ŒThreadè´Ÿè´£çº¿ç¨‹å¯åŠ¨ä»¥åŠå…¶ä»–è®¾ç½®ï¼Œæƒè´£åˆ†æ˜ã€‚\nä½¿ç”¨Runnableå¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± é¿å…å¤šæ¬¡æ–°å»ºé”€æ¯çº¿ç¨‹\nJavaä¸æ”¯æŒåŒç»§æ‰¿ï¼Œå› æ­¤ç±»ç»§æ‰¿Threadåæ— æ³•ç»§æ‰¿å…¶ä»–ç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œå› æ­¤ç»§æ‰¿Threadä¼šé™åˆ¶æ‹“å±•æ€§\n\nçº¿ç¨‹åœæ­¢æ–¹å¼å¦‚æœéœ€è¦æå‰åœæ­¢çº¿ç¨‹ï¼ˆç”¨æˆ·å…³é—­ç¨‹åºæˆ–è€…å†²è™šé‡å¯å‡ºé”™ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨interruptæ–¹æ³•é€šçŸ¥çº¿ç¨‹åœæ­¢ã€‚\n\nä¸ºä»€ä¹ˆä¸å¼ºåˆ¶ï¼šå¼ºåˆ¶åœæ­¢å¯èƒ½ä¼šé€ æˆå®‰å…¨é—®é¢˜ï¼Œæ¯”å¦‚æ–‡ä»¶å†™å…¥å¼ºåˆ¶åœæ­¢ä¼šå¯¼è‡´æ•°æ®ä¸å®Œæ•´ã€‚\n\nwhile (!Thread.currentThread().isInterrupted() &amp;&amp; more work to do) &#123;    do more work&#125;\n\nå¦‚æœçº¿ç¨‹åœ¨é˜»å¡ã€ç­‰å¾…ã€è®¡æ—¶ç­‰å¾…ç­‰çŠ¶æ€ï¼Œçº¿ç¨‹ä¼šæŠ›å‡ºInterrupted Exceptionå¼‚å¸¸ï¼ŒåŒæ—¶æ¸…é™¤ä¸­æ–­ä¿¡å·ã€‚å› æ­¤ï¼Œåœ¨ç¼–å†™å­æ–¹æ³•å¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªå¼‚å¸¸ï¼Œéœ€è¦æŠ›å‡ºæˆ–è€…åœ¨catchå†æ¬¡å£°æ˜ä¸­æ–­ã€‚\nä½¿ç”¨volatileä¿®é¥°æ ‡è®°ä½åœæ­¢æ–¹æ³•ä¸æ­£ç¡®æ˜¯å› ä¸ºï¼šå¦‚æœåœæ­¢çº¿ç¨‹Aæ—¶æ˜¯é€šè¿‡ä¿®æ”¹è¿™ä¸ªæ ‡å¿—ä½ï¼Œé‚£ä¹ˆå¦‚æœçº¿ç¨‹Aæ­¤æ—¶æ­£å¥½é˜»å¡ï¼Œæ˜¯æ— æ³•æ¥æ”¶åˆ°è¿™ä¸ªåœæ­¢ä¿¡å·çš„ï¼Œä½†æ˜¯interruptæ–¹æ³•å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å› æ­¤åœ¨ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚çº¿ç¨‹é•¿æ—¶é—´é˜»å¡ï¼Œæ— æ³•åŠæ—¶æ„Ÿå—åˆ°ä¸­æ–­ã€‚\n\nstop\\suspend\\resumeéƒ½è¢«åºŸå¼ƒï¼Œå¯èƒ½ä¼šå­˜åœ¨å®‰å…¨é£é™©æ¯”å¦‚æ­»é”ï¼Œ\n\nçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ\n\nNewï¼šnew Thread()åˆ›å»ºï¼Œä½†æ˜¯æœªè°ƒç”¨start()æ–¹æ³•ï¼Œè°ƒç”¨åå˜ä¸ºRunnable\nRunnableï¼šOSä¸­åˆ†ä¸º2ç§ï¼ŒReadyå’ŒRunningï¼ŒRunnableçŠ¶æ€è¡¨ç¤ºæ­£åœ¨æ‰§è¡Œæˆ–è€…åœ¨ç­‰å¾…CPUè½®è½¬\nä¸‰ç§é˜»å¡ï¼šBlockedã€Waitingã€Timed Waiting\nBlockedï¼šåªæœ‰synchronizedè·å–é”å¤±è´¥ä¼šä»Runnableè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œç¦»å¼€ä¹Ÿåªæœ‰æŠ¢åˆ°äº†å¯¹åº”çš„monitoré”ã€‚\nWaitingï¼šè¿›å…¥WaitingçŠ¶æ€æœ‰3ä¸­å¯èƒ½ï¼š\n\næ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•ã€‚\næ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•ã€‚\nLockSupport.park() æ–¹æ³•ã€‚\n\nJavaä¸­é™¤äº†sychronizedé”ï¼Œå…¶ä»–é”ï¼ˆå¦‚ReentrantLockï¼‰æ²¡æœ‰æŠ¢åˆ°éƒ½ä¼šè¿›å…¥Waitingï¼Œå› ä¸ºæœ¬è´¨æ˜¯è°ƒç”¨LockSupport.park() æ–¹æ³•ã€‚\nç¦»å¼€ï¼šåªæœ‰å½“æ‰§è¡Œäº† LockSupport.unpark()ï¼Œæˆ–è€… join çš„çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è€…è¢«ä¸­æ–­æ—¶æ‰å¯ä»¥è¿›å…¥ Runnable çŠ¶æ€ã€‚\nä½†å…¶ä»–çº¿ç¨‹è°ƒç”¨notifyæˆ–è€…notifyAllå”¤é†’æ­¤çº¿ç¨‹ï¼Œä¼šè¿›å…¥BlockedçŠ¶æ€ã€‚waitå’Œnotifyã€notifyAlléƒ½éœ€è¦åœ¨åŒæ­¥ä»£ç å—æˆ–è€…åŒæ­¥æ–¹æ³•ä¸­æ‰èƒ½ä½¿ç”¨ï¼Œwaitä¼šé‡Šæ”¾é”ï¼Œä½†notifyå’ŒnotifyAllä¸ä¼šï¼Œå› æ­¤åœ¨è¢«å”¤é†’çš„çº¿ç¨‹ä¼šè¿›å…¥BlockçŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾…å”¤é†’çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œé‡Šæ”¾é”ï¼Œæ‰å¯ä»¥ç«äº‰é”ï¼Œå›åˆ°RunnableçŠ¶æ€ã€‚\n\nBlockedä¸WaitingåŒºåˆ«:\n\nBlockedæ˜¯åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾monitoré”\nWaitingæ˜¯åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶ï¼Œæ¯”å¦‚joinçº¿ç¨‹ä¸­å¿ƒå®Œæ¯•ï¼Œæˆ–è€…notify&#x2F;notifyAll\n\n\nTimed Waitingï¼šä¸Waitç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºæœ‰æ—¶é—´é™åˆ¶ï¼Œä¼šç­‰å¾…è¶…æ—¶è‡ªåŠ¨å”¤é†’æˆ–è€…è¶…æ—¶å‰è¢«å”¤é†’ä¿¡å·å”¤é†’\n\nè®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Thread.sleep(long millis) æ–¹æ³•ï¼›\nè®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Object.wait(long timeout) æ–¹æ³•ï¼›\nè®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Thread.join(long millis) æ–¹æ³•ï¼›\nè®¾ç½®äº†æ—¶é—´å‚æ•°çš„ LockSupport.parkNanos(long nanos) æ–¹æ³•å’Œ LockSupport.parkUntil(long deadline) æ–¹æ³•ã€‚\n\nç¦»å¼€ï¼šä¸Waitç±»ä¼¼ï¼Œä½†è¶…æ—¶ä¼šè‡ªåŠ¨å”¤é†’ï¼Œ\nTerminatedï¼šrunæ–¹æ³•æ‰§è¡Œå®Œæ¯•çº¿ç¨‹è‡ªåŠ¨é€€å‡ºï¼Œæˆ–è€…å‡ºç°æœªæ•è·çš„å¼‚å¸¸ç»ˆæ­¢runæ–¹æ³•ï¼Œå°±ä¼šè¿›å…¥ç»ˆæ­¢ã€‚è¿›å…¥ç»ˆæ­¢åä¸å¯é€†ã€‚ï¼ˆNewå’ŒTerminatedéƒ½åªèƒ½æœ‰ä¸€æ¬¡ï¼‰\n\næ³¨æ„waitå¯èƒ½ä¼šå­˜åœ¨è™šå‡å”¤é†’ï¼Œå› æ­¤ä¸€èˆ¬éœ€è¦ç»™ä¸€ä¸ªæ¡ä»¶æ¥é¿å…ã€‚\n\nä¸ºä»€ä¹ˆwait&#x2F;notify&#x2F;notifyAllåœ¨Objectç±»ï¼Œè€Œsleepåœ¨Threadç±»ä¸­\nå› ä¸ºJavaæ¯ä¸ªå¯¹è±¡é‚£ä¸ªéƒ½æœ‰ä¸€ä¸ªmonitoré”ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä¸Šé”ï¼Œè¿™å°±æ„å‘³ç€é”æ˜¯å¯¹è±¡çº§åˆ«ï¼Œè€Œä¸æ˜¯çº¿ç¨‹çº§åˆ«ï¼Œwait&#x2F;notify&#x2F;notifyAlléƒ½æ˜¯é”çº§åˆ«æ“ä½œï¼Œå› ä¸ºåœ¨Objectè¿™ä¸ªæ‰€æœ‰ç±»çš„çˆ¶ç±»ä¸­å®šä¹‰æœ€åˆé€‚ã€‚ï¼ˆè€Œsleepåˆ™æ˜¯çº¿ç¨‹çº§åˆ«æ“ä½œï¼Œæ˜¯è¿™ä¸ªçº¿ç¨‹è‡ªå‘çš„ï¼Œä¸å…¶ä»–çº¿ç¨‹æ— å…³ï¼‰\nå¦‚æœæŠŠwait&#x2F;notify&#x2F;notifyAllå®šä¹‰åœ¨Threadä¸­ï¼Œä¼šå¯¼è‡´å±€é™ã€‚å› ä¸ºä¸€ä¸ªçº¿ç¨‹å¯èƒ½æŒæœ‰å¤šæŠŠé”ï¼Œå®šä¹‰åœ¨Threadä¸­æ— æ³•å®ç°æŒæœ‰å¤šæŠŠé”ï¼Œä¹Ÿæ— æ³•æ˜ç¡®æŒæœ‰çš„æ˜¯å“ªæŠŠé”ã€‚\n\nwait&#x2F;notifyå’Œsleepå¼‚åŒ\nå®ƒä»¬éƒ½å¯ä»¥è®©çº¿ç¨‹é˜»å¡ã€‚\nå®ƒä»¬éƒ½å¯ä»¥å“åº” interrupt ä¸­æ–­ï¼šåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­å¦‚æœæ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œéƒ½å¯ä»¥è¿›è¡Œå“åº”ï¼Œå¹¶æŠ›å‡º InterruptedException å¼‚å¸¸ã€‚\n\nä½†æ˜¯å®ƒä»¬ä¹Ÿæœ‰å¾ˆå¤šçš„ä¸åŒç‚¹ï¼š\n\nwait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„ä»£ç ä¸­ä½¿ç”¨ï¼Œè€Œ sleep æ–¹æ³•å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚\nåœ¨åŒæ­¥ä»£ç ä¸­æ‰§è¡Œ sleep æ–¹æ³•æ—¶ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾ monitor é”ï¼Œä½†æ‰§è¡Œ wait æ–¹æ³•æ—¶ä¼šä¸»åŠ¨é‡Šæ”¾ monitor é”ã€‚\nsleep æ–¹æ³•ä¸­ä¼šè¦æ±‚å¿…é¡»å®šä¹‰ä¸€ä¸ªæ—¶é—´ï¼Œæ—¶é—´åˆ°æœŸåä¼šä¸»åŠ¨æ¢å¤ï¼Œè€Œå¯¹äºæ²¡æœ‰å‚æ•°çš„ wait æ–¹æ³•è€Œè¨€ï¼Œæ„å‘³ç€æ°¸ä¹…ç­‰å¾…ï¼Œç›´åˆ°è¢«ä¸­æ–­æˆ–è¢«å”¤é†’æ‰èƒ½æ¢å¤ï¼Œå®ƒå¹¶ä¸ä¼šä¸»åŠ¨æ¢å¤ã€‚\nwait&#x2F;notify æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œè€Œ sleep æ˜¯ Thread ç±»çš„æ–¹æ³•ã€‚\n\nçº¿ç¨‹å®‰å…¨å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜\n\nè¿è¡Œç»“æœé”™è¯¯ï¼ši++ç­‰ï¼Œé€šå¸¸å› ä¸ºå¹¶å‘è¯»å†™\næ²¡æœ‰åœ¨æ­£ç¡®çš„æ—¶é—´ã€åœ°ç‚¹è¢«å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜\næ´»è·ƒæ€§é—®é¢˜ï¼šæ­»é”ã€æ´»é”å’Œé¥¥é¥¿\n\nä»€ä¹ˆæ—¶å€™éœ€è¦ç‰¹åˆ«æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜\n\nå½“é—®å…±äº«å˜é‡æˆ–èµ„æº\nä¾èµ–æ—¶åºçš„æ“ä½œï¼šæ£€æŸ¥ä¸æ‰§è¡Œå¹¶éåŸåˆ™æ“ä½œï¼Œä¸­é—´æ‰“æ–­å¯¼è‡´æ£€æŸ¥å¤±æ•ˆï¼Œéœ€è¦åŠ é”ç­‰æªæ–½ä¿è¯åŸå­æ€§\nä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»ï¼šéœ€è¦åŒæ—¶æ›´æ–°ï¼Œå› æ­¤ä¹Ÿéœ€è¦ä¿éšœåŸå­æ€§\nå¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼šæ¯”å¦‚ArrayList\n\nä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šæœ‰æ€§èƒ½é—®é¢˜\nè°ƒåº¦å¼€é”€ï¼šçŸ­ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€å¯èƒ½æ¯”ä»»åŠ¡æœ¬èº«è¿˜å¤§ï¼›ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶çº¿ç¨‹ç¼“å­˜å¤±æ•ˆéœ€è¦é‡å»ºã€‚å› æ­¤ä¸€èˆ¬è¦é¿å…å¯†é›†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç³»ç»Ÿå­˜åœ¨çº¿ç¨‹æœ€å°æ‰§è¡Œæ—¶é—´ã€‚\nåä½œå¼€é”€ï¼šçº¿ç¨‹ä¹‹é—´å­˜åœ¨å…±äº«æ•°æ®ï¼Œçº¿ç¨‹å·¥ä½œå†…å­˜çš„æ•°æ® flush åˆ°ä¸»å­˜ä¸­ï¼Œç„¶åå†ä»ä¸»å†…å­˜ refresh åˆ°å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œå› æ­¤ä¼šå­˜åœ¨å¤šçº¿ç¨‹çš„åä½œå¼€é”€ã€‚\n\nçº¿ç¨‹æ± çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªï¼Ÿ\né¿å…åå¤åˆ›å»ºçº¿ç¨‹å¼€é”€å¤§ï¼šçº¿ç¨‹æ± å¯ä»¥ç”¨ä¸€äº›å›ºå®šçš„çº¿ç¨‹ä¸€ç›´ä¿æŒå·¥ä½œçŠ¶æ€å¹¶åå¤æ‰§è¡Œä»»åŠ¡ã€‚\né¿å…è¿‡å¤šçº¿ç¨‹å ç”¨å¤ªå¤šå†…å­˜èµ„æºçš„é—®é¢˜ï¼Œçº¿ç¨‹æ± ä¼šæ ¹æ®éœ€è¦åˆ›å»ºçº¿ç¨‹ï¼Œæ§åˆ¶çº¿ç¨‹çš„æ€»æ•°é‡ï¼Œé¿å…å ç”¨è¿‡å¤šå†…å­˜èµ„æºã€‚\nçº¿ç¨‹æ± è¿˜å¯ä»¥ç»Ÿä¸€ç®¡ç†å†…å­˜ã€CPUç­‰èµ„æºï¼Œç»Ÿä¸€å¼€å§‹æˆ–ç»“æŸä»»åŠ¡ï¼Œæ›´æ˜“äºç®¡ç†ä¸”æœ‰åˆ©äºæ•°æ®ç»Ÿè®¡ã€‚\n\nçº¿ç¨‹æ± å‚æ•°\ncorePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°\nmaximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°\nThreadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºæ–°çº¿ç¨‹\nworkQueueï¼šå­˜æ”¾ä»»åŠ¡çš„é˜Ÿåˆ—\nHandlerï¼šæ‹’ç»ç­–ç•¥ï¼Œç”¨äºå¤„ç†è¢«æ‹’ç»ä»»åŠ¡\nkeepAliveTime+unitï¼šç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´åŠå…¶å•ä½\n\nçº¿ç¨‹æ± å·¥ä½œæµç¨‹&#x2F;åŸç†\n\n\n\nå½“æäº¤ä»»åŠ¡åï¼Œ\n\nå¦‚æœçº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨å¿™ï¼Œå¹¶ä¸”çº¿ç¨‹æ± æœªè¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ–°æäº¤çš„ä»»åŠ¡ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—ä¸­è¿›è¡Œç­‰å¾…ã€‚\nå¦‚æœä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”å½“å‰çº¿ç¨‹æ•°é‡å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚\nå¦‚æœæ ¸å¿ƒçº¿ç¨‹å·²æ»¡ï¼Œå·¥ä½œé˜Ÿåˆ—å·²æ»¡ï¼Œçº¿ç¨‹æ± å·²æ»¡ï¼Œå°±ä¼šæ ¹æ®æ‹’ç»ç­–ç•¥æ‹’ç»ä»»åŠ¡ã€‚\n\nç©ºé—²çš„çº¿ç¨‹ä¼šä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œçº¿ç¨‹å¹¶ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ç»§ç»­ä¿æŒåœ¨æ± ä¸­ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚\nå½“çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…å‡ºæŒ‡å®šæ—¶é—´ï¼Œä¸”å½“å‰çº¿ç¨‹æ•°é‡å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«å›æ”¶ã€‚\n4ç§æ‹’ç»ç­–ç•¥\nAbortPolicyï¼šç»ˆæ­¢ç­–ç•¥ï¼Œæ‹’ç»æ—¶æŠ›å‡ºRejectedExecutionException çš„ RuntimeExceptionï¼Œè®©ä½ æ„ŸçŸ¥åˆ°ä»»åŠ¡è¢«æ‹’ç»äº†ï¼Œäºæ˜¯ä½ ä¾¿å¯ä»¥æ ¹æ®ä¸šåŠ¡é€»è¾‘é€‰æ‹©é‡è¯•æˆ–è€…æ”¾å¼ƒæäº¤ç­‰ç­–ç•¥ã€‚\nDiscardPolicyï¼šä¸¢å¼ƒç­–ç•¥ï¼Œæ‹’ç»æ—¶ç›´æ¥ä¸¢å¼ƒï¼Œä¸ç»™é€šçŸ¥ã€‚\nDiscardOldestPolicyï¼šä¸¢å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­å¤´ç»“ç‚¹ï¼Œä½†ä¹Ÿæ²¡æœ‰é€šçŸ¥ã€‚\nCallerRunsPolicyï¼šæ–°ä»»åŠ¡ä¼šäº¤ç»™æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ‰§è¡Œã€‚\n\n6ç§çº¿ç¨‹æ± \nFixedThreadPoolï¼šæ ¸å¿ƒçº¿ç¨‹æ•°&#x3D;æœ€å¤§çº¿ç¨‹æ•°ï¼Œå› æ­¤çº¿ç¨‹ä¸ªæ•°æœ€å¤§å›ºå®šï¼Œä»»åŠ¡é˜Ÿåˆ—size&#x3D;0ï¼Œ\n\nCachedThreadPoolï¼šçº¿ç¨‹æ•°å¯ä»¥æ— çº¿å¢åŠ è‡³Integer.MAX_VALUEï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸ºSynchronousQueueï¼Œé˜Ÿåˆ—å®¹é‡ä¸º0ã€‚\n\nScheduledThreadPoolï¼šå®šæ—¶æˆ–å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡ã€‚\n\nSingleThreadExecutorï¼šç”¨å”¯ä¸€çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå› æ­¤æ‰€æœ‰ä»»åŠ¡é¡ºåºæ‰§è¡Œã€‚\n\nSingleThreadScheduledExecutorï¼šå³new ScheduledThreadPoolExecutor(1)\n\nForkJoinPoolï¼šç”¨äºæ‹†åˆ†æ±‡æ€»æ‰§è¡Œä»»åŠ¡\n\n\nçº¿ç¨‹æ± çš„é˜»å¡é˜Ÿåˆ—LinkedBlockingQueueï¼šæ— ç•Œé˜Ÿåˆ—ï¼Œå®¹é‡é»˜è®¤ä¸ºInteger.MAX_VALUE\nSynchronousQueueï¼šå®¹é‡ä¸º0ï¼Œæ¯æ¬¡è¯»å–æ•°æ®éƒ½è¦è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰æ•°æ®è¢«æ”¾å…¥ï¼›æ¯æ¬¡æ”¾æ•°æ®ä¹Ÿè¢«é˜»å¡ï¼Œç›´åˆ°æœ‰æ¶ˆè´¹è€…æ¥å–ã€‚ï¼ˆåªæœ‰putå’Œtakeï¼‰\nDelayedWorkQueueï¼šå†…éƒ¨å…ƒç´ æŒ‰ç…§å»¶è¿Ÿçš„æ—¶é—´é•¿çŸ­æ’åº\nä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± è‡ªåŠ¨åˆ›å»ºçš„çº¿ç¨‹æ± éƒ½å­˜åœ¨é£é™©ï¼Œæ‰‹åŠ¨åˆ›å»ºå¯ä»¥æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œå¹¶è‡ªå·±é€‰æ‹©åˆé€‚çš„çº¿ç¨‹æ•°å’Œæ‹’ç»ç­–ç•¥ã€‚\nå¦‚ä½•é€‰æ‹©çº¿ç¨‹æ•°\nCPUå¯†é›†å‹ï¼šä¸€èˆ¬æ˜¯CPUæ ¸å¿ƒæ•°1-2å€ã€‚å¦‚æœè¿‡å¤šï¼Œä¼šé€ æˆä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿‡å°‘å°±ä¼šæµªè´¹CPU\nè€—æ—¶IOå‹ï¼šçº¿ç¨‹æ•° &#x3D; CPU æ ¸å¿ƒæ•° *ï¼ˆ1+å¹³å‡ç­‰å¾…æ—¶é—´&#x2F;å¹³å‡å·¥ä½œæ—¶é—´ï¼‰\nçº¿ç¨‹çš„å¹³å‡å·¥ä½œæ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œå°±éœ€è¦è¶Šå°‘çš„çº¿ç¨‹ï¼›\nçº¿ç¨‹çš„å¹³å‡ç­‰å¾…æ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œå°±éœ€è¦è¶Šå¤šçš„çº¿ç¨‹ï¼›\né’ˆå¯¹ä¸åŒçš„ç¨‹åºï¼Œè¿›è¡Œå¯¹åº”çš„å®é™…æµ‹è¯•å°±å¯ä»¥å¾—åˆ°æœ€åˆé€‚çš„é€‰æ‹©ã€‚\n\n\n\nçº¿ç¨‹æ± å¦‚ä½•å…³é—­\nshutdownï¼šä¼šç­‰å¾…çº¿ç¨‹æ± ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå…³é—­ï¼Œè°ƒç”¨åæäº¤æ–°ä»»åŠ¡ä¼šæ ¹æ®æ‹’ç»ç­–ç•¥æ‹’ç»\nisShutdownï¼šä¼šåˆ¤æ–­æ˜¯å¦æ‰§è¡Œäº†shutdownæˆ–è€…shudownNowï¼Œè¿”å›trueå¹¶ä¸æ„å‘³ç€çº¿ç¨‹æ± å·²ç»å…³é—­\nisTerminatedï¼šåˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦çœŸçš„ç»ˆç»“\nawaitTerminationï¼šæ ¹æ®ä¼ å…¥å‚æ•°ï¼Œç­‰å¾…ï¼Œè¿”å›çº¿ç¨‹æ± æ˜¯å¦ç»ˆç»“\nshutdownNowï¼šä¼šç»™çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹å‘é€interruptä¿¡å·ï¼Œå¹¶è¿”å›æ‰€æœ‰æ­£åœ¨ç­‰å¾…ä»»åŠ¡åˆ—è¡¨\n\nçº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†çº¿ç¨‹æ± å¯¹Threadè¿›è¡Œäº†å°è£…ï¼Œä¸æ˜¯æ¯æ¬¡æ‰§è¡Œä»»åŠ¡éƒ½è°ƒç”¨startæ–¹æ³•åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè€Œæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¾ªç¯ä»»åŠ¡ï¼Œåœ¨è¿™ä¸ªå¾ªç¯ä»»åŠ¡ä¸­ï¼Œä¸æ–­æ£€æŸ¥æ˜¯å¦æœ‰ä»»åŠ¡ç­‰å¾…è¢«æ‰§è¡Œï¼Œæœ‰å°±è°ƒç”¨ä»»åŠ¡çš„runæ–¹æ³•ï¼Œ\n1. é”é”çš„åˆ†ç±»åå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”\nåå‘é”ï¼šä¸å­˜åœ¨ç«äº‰çš„å¤šï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œä¼šè®°å½•è¯¥çº¿ç¨‹ï¼Œå¦‚æœä¹‹åè·å–é”çš„çº¿ç¨‹æ­£å¥½æ˜¯åå‘é”çš„æ‹¥æœ‰è€…ï¼Œå°±å¯ä»¥ç›´æ¥è·å¾—é”ã€‚\nè½»é‡çº§é”ï¼šå½“é”åŸæ¥æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œè¯´æ˜å­˜åœ¨ç«äº‰ï¼Œé‚£ä¹ˆåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œçº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œè€Œä¸ä¼šé™·å…¥é˜»å¡ã€‚\né‡é‡çº§é”ï¼šå½“å¤šä¸ªçº¿ç¨‹ç›´æ¥æœ‰å®é™…ç«äº‰ï¼Œä¸”é”ç«äº‰æ—¶é—´é•¿çš„æ—¶å€™ï¼Œè½»é‡çº§é”ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œé”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·å´æ‹¿ä¸åˆ°é”çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚\n\né”å‡çº§è·¯çº¿ï¼šæ— é”â†’åå‘é”â†’è½»é‡çº§é”â†’é‡é‡çº§é”ã€‚\nå¯é‡å…¥é”&#x2F;éå¯é‡å…¥é”å¯é‡å…¥é”æŒ‡çš„æ˜¯çº¿ç¨‹å½“å‰å·²ç»æŒæœ‰è¿™æŠŠé”äº†ï¼Œèƒ½åœ¨ä¸é‡Šæ”¾è¿™æŠŠé”çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡è·å–è¿™æŠŠé”ã€‚\nä¸å¯é‡å…¥é”æŒ‡çš„æ˜¯è™½ç„¶çº¿ç¨‹å½“å‰æŒæœ‰äº†è¿™æŠŠé”ï¼Œä½†æ˜¯å¦‚æœæƒ³å†æ¬¡è·å–è¿™æŠŠé”ï¼Œä¹Ÿå¿…é¡»è¦å…ˆé‡Šæ”¾é”åæ‰èƒ½å†æ¬¡å°è¯•è·å–ã€‚\nå…±äº«é”&#x2F;ç‹¬å é”å…±äº«é”æŒ‡çš„æ˜¯æˆ‘ä»¬åŒä¸€æŠŠé”å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å¾—ï¼Œè€Œç‹¬å é”æŒ‡çš„å°±æ˜¯ï¼Œè¿™æŠŠé”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ã€‚\nè¯»å†™é”ä¸­çš„è¯»é”ï¼Œæ˜¯å…±äº«é”ï¼Œè€Œå†™é”æ˜¯ç‹¬å é”ã€‚è¯»é”å¯ä»¥è¢«åŒæ—¶è¯»ï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ï¼Œè€Œå†™é”æœ€å¤šåªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚\n\nè¯»å†™é”è·å–è§„åˆ™ï¼šè¯»è¯»å…±äº«ï¼Œå…¶ä»–éƒ½äº’æ–¥ã€‚è¦ä¹ˆæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åŒæ—¶æœ‰è¯»é”ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªçº¿ç¨‹æœ‰å†™é”ï¼Œä½†æ˜¯ä¸¤è€…ä¸ä¼šåŒæ—¶å‡ºç°ã€‚\næ’é˜Ÿç­–ç•¥ï¼š\n\nå…¬å¹³è¯»å†™é”éƒ½å¾—æ’é˜Ÿ\néå…¬å¹³è¯»å†™é”ï¼šå†™é”æ’é˜Ÿï¼Œæ¸é”ä¸èƒ½æ’é˜Ÿï¼Œé¿å…å†™é”è·å–é¥¥é¥¿ã€‚\n\nå‡é™çº§ç­–ç•¥ï¼šåªèƒ½ä»å†™é”é™çº§ä¸ºè¯»é”ï¼Œä¸èƒ½ä»è¯»é”å‡çº§ä¸ºå†™é”ã€‚\n\nå¦åˆ™å¦‚æœABéƒ½æƒ³å‡çº§ä¸ºå†™é”ï¼Œé‚£ä¹ˆå°±éƒ½è¦ç­‰å¾…å¯¹è±¡é‡Šæ”¾æ¸é”ï¼Œé€ æˆæ­»é”ã€‚\n\n\nå…¬å¹³é”&#x2F;éå…¬å¹³é”å…¬å¹³é”çš„å…¬å¹³çš„å«ä¹‰åœ¨äºå¦‚æœçº¿ç¨‹ç°åœ¨æ‹¿ä¸åˆ°è¿™æŠŠé”ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±éƒ½ä¼šè¿›å…¥ç­‰å¾…ï¼Œå¼€å§‹æ’é˜Ÿï¼Œåœ¨ç­‰å¾…é˜Ÿåˆ—é‡Œç­‰å¾…æ—¶é—´é•¿çš„çº¿ç¨‹ä¼šä¼˜å…ˆæ‹¿åˆ°è¿™æŠŠé”ï¼Œæœ‰å…ˆæ¥å…ˆå¾—çš„æ„æ€ã€‚\néå…¬å¹³é”æ˜¯åœ¨è·å–é”æ—¶ï¼Œå¦‚æœé”æ°å¥½è¢«é‡Šæ”¾ï¼Œå°±ä¼šç›´æ¥è·å–é”ï¼Œå¿½ç•¥æ‰å·²ç»åœ¨æ’é˜Ÿçš„çº¿ç¨‹ï¼Œå‘ç”Ÿæ’é˜Ÿç°è±¡ã€‚\næ‚²è§‚é”&#x2F;ä¹è§‚é”æ‚²è§‚é”è®¤ä¸ºç«äº‰ä¸€å®šå­˜åœ¨ï¼Œå› æ­¤ä¼šåœ¨è·å–èµ„æºä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‹¿åˆ°é”ï¼Œé”ä½èµ„æºã€‚æ¯”å¦‚synchronizedå’ŒLockæ¥å£ç›¸å…³ç±»ã€‚\nä¹è§‚é”è®¤ä¸ºç«äº‰ä¸ä¸€å®šå­˜åœ¨ï¼Œä¼šé€šè¿‡casè¿›è¡Œèµ„æºä¿®æ”¹ã€‚æ¯”å¦‚åŸå­ç±»ã€‚\nè‡ªæ—‹é”&#x2F;éè‡ªæ—‹é”è‡ªæ—‹é”æ˜¯åœ¨æ‹¿ä¸åˆ°é”æ—¶ï¼Œä¸ä¼šé™·å…¥é˜»å¡æˆ–è€…é‡Šæ”¾èµ„æºï¼Œè€Œæ˜¯åˆ©ç”¨å¾ªç¯ï¼Œä¸åœåœ°å°è¯•è·å–é”ï¼Œè¿™ä¸ªå¾ªç¯è¿‡ç¨‹è¢«å½¢è±¡åœ°æ¯”å–»ä¸ºâ€œè‡ªæ—‹â€ã€‚\néè‡ªæ—‹é”çš„ç†å¿µå°±æ˜¯æ²¡æœ‰è‡ªæ—‹çš„è¿‡ç¨‹ï¼Œå¦‚æœæ‹¿ä¸åˆ°é”å°±ç›´æ¥æ”¾å¼ƒï¼Œæˆ–è€…è¿›è¡Œå…¶ä»–çš„å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚å»æ’é˜Ÿã€é™·å…¥é˜»å¡ç­‰ã€‚\n\nè‡ªæ—‹é”å¥½å¤„ï¼šé¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæé«˜æ•ˆç‡ï¼›ç¼ºç‚¹å¦‚æœå°è¯•è¿‡å¤šï¼Œä¹Ÿæ˜¯æµªè´¹èµ„æºã€‚å› æ­¤é€‚ç”¨å¹¶å‘åº¦ä¸é«˜ï¼Œä¸´ç•ŒåŒºè¾ƒå°ï¼ˆæ‹¿åˆ°é”å¾ˆå¿«å¯ä»¥é‡Šæ”¾ï¼‰\n\nå¯ä¸­æ–­é”&#x2F;ä¸å¯ä¸­æ–­é”synchronized å…³é”®å­—ä¿®é¥°çš„é”ä»£è¡¨çš„æ˜¯ä¸å¯ä¸­æ–­é”ï¼Œä¸€æ—¦çº¿ç¨‹ç”³è¯·äº†é”ï¼Œå°±æ²¡æœ‰å›å¤´è·¯äº†ï¼Œåªèƒ½ç­‰åˆ°æ‹¿åˆ°é”ä»¥åæ‰èƒ½è¿›è¡Œå…¶ä»–çš„é€»è¾‘å¤„ç†ã€‚\nReentrantLock æ˜¯ä¸€ç§å…¸å‹çš„å¯ä¸­æ–­é”ï¼Œä¾‹å¦‚ä½¿ç”¨ lockInterruptibly æ–¹æ³•åœ¨è·å–é”çš„è¿‡ç¨‹ä¸­ï¼Œçªç„¶ä¸æƒ³è·å–äº†ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åœ¨ä¸­æ–­ä¹‹åå»åšå…¶ä»–çš„äº‹æƒ…ï¼Œä¸éœ€è¦ä¸€ç›´å‚»ç­‰åˆ°è·å–åˆ°é”æ‰ç¦»å¼€ã€‚\nSynchronizedåŸç†åŒæ­¥ä»£ç å—ï¼šä¼šé€šè¿‡monitorenterå’Œmonitorexitä¸¤æ¡å‘½ä»¤å®ç°\n\næ‰§è¡Œ monitorenter çš„çº¿ç¨‹å°è¯•è·å¾— monitor çš„æ‰€æœ‰æƒ\nå¦‚æœè¯¥ monitor çš„è®¡æ•°ä¸º 0ï¼Œåˆ™çº¿ç¨‹è·å¾—è¯¥ monitor å¹¶å°†å…¶è®¡æ•°è®¾ç½®ä¸º 1ã€‚ç„¶åï¼Œè¯¥çº¿ç¨‹å°±æ˜¯è¿™ä¸ª monitor çš„æ‰€æœ‰è€…ã€‚\nå¦‚æœçº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ª monitor ï¼Œåˆ™å®ƒå°†é‡æ–°è¿›å…¥ï¼Œå¹¶ä¸”ç´¯åŠ è®¡æ•°ã€‚\nå¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ª monitorï¼Œé‚£ä¸ªè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è¿™ä¸ª monitor çš„è®¡æ•°å˜æˆä¸º 0ï¼Œä»£è¡¨è¿™ä¸ª monitor å·²ç»è¢«é‡Šæ”¾äº†ï¼Œäºæ˜¯å½“å‰è¿™ä¸ªçº¿ç¨‹å°±ä¼šå†æ¬¡å°è¯•è·å–è¿™ä¸ª monitorã€‚\n\n\nmonitorexit çš„ä½œç”¨æ˜¯å°† monitor çš„è®¡æ•°å™¨å‡ 1ï¼Œç›´åˆ°å‡ä¸º 0 ä¸ºæ­¢ã€‚ä»£è¡¨è¿™ä¸ª monitor å·²ç»è¢«é‡Šæ”¾äº†ï¼Œå·²ç»æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ‹¥æœ‰å®ƒäº†ï¼Œä¹Ÿå°±ä»£è¡¨ç€è§£é”ï¼Œæ‰€ä»¥ï¼Œå…¶ä»–æ­£åœ¨ç­‰å¾…è¿™ä¸ª monitor çš„çº¿ç¨‹ï¼Œæ­¤æ—¶ä¾¿å¯ä»¥å†æ¬¡å°è¯•è·å–è¿™ä¸ª monitor çš„æ‰€æœ‰æƒã€‚\n\nåŒæ­¥æ–¹æ³•ï¼šæ–¹æ³•ä¼šæœ‰ä¸€ä¸ªACC_SYNCHRONIZEDä¿®é¥°ç¬¦\nå½“çº¿ç¨‹è®¿é—®æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆæ£€æŸ¥æ–¹æ³•æ˜¯å¦æœ‰ ACC_SYNCHRONIZED æ ‡å¿—ï¼Œå¦‚æœæœ‰åˆ™éœ€è¦å…ˆè·å¾— monitor é”ï¼Œç„¶åæ‰èƒ½å¼€å§‹æ‰§è¡Œæ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œä¹‹åå†é‡Šæ”¾ monitor é”ã€‚\né”ä¼˜åŒ–è‡ªé€‚åº”çš„è‡ªæ—‹é”åœ¨ JDK 1.6 ä¸­å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”æ¥è§£å†³é•¿æ—¶é—´è‡ªæ—‹çš„é—®é¢˜ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸å†å›ºå®šï¼Œè€Œæ˜¯ä¼šæ ¹æ®æœ€è¿‘è‡ªæ—‹å°è¯•çš„æˆåŠŸç‡ã€å¤±è´¥ç‡ï¼Œä»¥åŠå½“å‰é”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€ç­‰å¤šç§å› ç´ æ¥å…±åŒå†³å®šã€‚è‡ªæ—‹çš„æŒç»­æ—¶é—´æ˜¯å˜åŒ–çš„ï¼Œè‡ªæ—‹é”å˜â€œèªæ˜â€äº†ã€‚æ¯”å¦‚ï¼Œå¦‚æœæœ€è¿‘å°è¯•è‡ªæ—‹è·å–æŸä¸€æŠŠé”æˆåŠŸäº†ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å¯èƒ½è¿˜ä¼šç»§ç»­ä½¿ç”¨è‡ªæ—‹ï¼Œå¹¶ä¸”å…è®¸è‡ªæ—‹æ›´é•¿çš„æ—¶é—´ï¼›ä½†æ˜¯å¦‚æœæœ€è¿‘è‡ªæ—‹è·å–æŸä¸€æŠŠé”å¤±è´¥äº†ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šçœç•¥æ‰è‡ªæ—‹çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿å‡å°‘æ— ç”¨çš„è‡ªæ—‹ï¼Œæé«˜æ•ˆç‡ã€‚\nåå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”\nåå‘é”ï¼šä¸å­˜åœ¨ç«äº‰çš„å¤šï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œä¼šè®°å½•è¯¥çº¿ç¨‹ï¼Œå¦‚æœä¹‹åè·å–é”çš„çº¿ç¨‹æ­£å¥½æ˜¯åå‘é”çš„æ‹¥æœ‰è€…ï¼Œå°±å¯ä»¥ç›´æ¥è·å¾—é”ã€‚\nè½»é‡çº§é”ï¼šå½“é”åŸæ¥æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œè¯´æ˜å­˜åœ¨ç«äº‰ï¼Œé‚£ä¹ˆåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œçº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œè€Œä¸ä¼šé™·å…¥é˜»å¡ã€‚\né‡é‡çº§é”ï¼šå½“å¤šä¸ªçº¿ç¨‹ç›´æ¥æœ‰å®é™…ç«äº‰ï¼Œä¸”é”ç«äº‰æ—¶é—´é•¿çš„æ—¶å€™ï¼Œè½»é‡çº§é”ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œé”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·å´æ‹¿ä¸åˆ°é”çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚\n\né”å‡çº§è·¯çº¿ï¼šæ— é”â†’åå‘é”â†’è½»é‡çº§é”â†’é‡é‡çº§é”ã€‚\n2. å¹¶å‘é›†åˆHashMapHashMapä¸ºä½•çº¿ç¨‹ä¸å®‰å…¨\nåŒæ—¶putç¢°æ’å¯¼è‡´æ•°æ®ä¸¢å¤±\næ— æ³•ä¿è¯å¯è§æ€§\nã€‚ã€‚ã€‚\n\nConcurrentHashMapåŸç†Java7ï¼šåœ¨ConcurrentHashMapå†…éƒ¨è¿›è¡ŒSegmentåˆ†æ®µï¼ŒSegment ç»§æ‰¿äº† ReentrantLockï¼Œå¯ä»¥ç†è§£ä¸ºä¸€æŠŠé”ï¼Œå„ä¸ª Segment ä¹‹é—´éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹ä¸Šé”çš„ï¼Œäº’ä¸å½±å“ã€‚ç›¸æ¯”äºä¹‹å‰çš„ Hashtable æ¯æ¬¡æ“ä½œéƒ½éœ€è¦æŠŠæ•´ä¸ªå¯¹è±¡é”ä½è€Œè¨€ï¼Œå¤§å¤§æé«˜äº†å¹¶å‘æ•ˆç‡ã€‚å› ä¸ºå®ƒçš„é”ä¸é”ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è±¡åªæœ‰ä¸€æŠŠé”ã€‚\næ¯ä¸ªSegmentåº•å±‚å’ŒHashMapç±»ä¼¼ï¼Œä¾ç„¶æ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼Œé»˜è®¤16ä¸ªSegementã€‚\nJava8ï¼šæ”¾å¼ƒäº† Segment çš„è®¾è®¡ï¼Œé‡‡ç”¨ Node + CAS + synchronized ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚é”ç²’åº¦æ›´ç»†ï¼Œç†æƒ³æƒ…å†µä¸‹ table æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„é•¿åº¦ï¼‰å°±æ˜¯å…¶æ”¯æŒå¹¶å‘çš„æœ€å¤§ä¸ªæ•°ï¼Œå¹¶å‘åº¦æ¯”ä¹‹å‰æœ‰æé«˜ã€‚\n\nä¸ºä»€ä¹ˆä¸åªç”¨çº¢é»‘æ ‘ï¼Ÿ\n\nTreeNodeç›¸å¯¹å ç”¨ç©ºé—´ï¼ŒçŸ­é“¾è¡¨å ç”¨ç©ºé—´å°‘ã€æŸ¥æ‰¾å¿«\nhashåˆ†å¸ƒè‰¯å¥½æ—¶ï¼Œä¸å¤ªä¼šå‘ç”Ÿé“¾è¡¨å¾ˆé•¿ï¼Œç”¨ä¸åˆ°çº¢é»‘æ ‘\nç”¨çº¢é»‘æ ‘ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·è‡ªå·±å®ç°äº†ä¸å¥½çš„å“ˆå¸Œç®—æ³•å¯¼è‡´é“¾è¡¨è¿‡é•¿ï¼Œæ˜¯ä¸€ç§ä¿åº•ç­–ç•¥\n\n\nHashTableåº•å±‚é€šè¿‡sychronizedå…³é”®å­—å®ç°ï¼Œå‡ ä¹æ‰€æœ‰æ–¹æ³•éƒ½ç”¨äº†synchronizedä¿®é¥°ã€‚\næ³¨æ„ï¼šHashtableï¼ˆåŒ…æ‹¬ HashMapï¼‰ä¸å…è®¸åœ¨è¿­ä»£æœŸé—´ä¿®æ”¹å†…å®¹ï¼Œå¦åˆ™ä¼šæŠ›å‡ºConcurrentModificationException å¼‚å¸¸ï¼Œå…¶åŸç†æ˜¯æ£€æµ‹ modCount å˜é‡æ˜¯å¦ç­‰äº expectedModCountã€‚å…¶ä¸­ expectedModCount æ˜¯åœ¨è¿­ä»£å™¨ç”Ÿæˆçš„æ—¶å€™éšä¹‹ç”Ÿæˆçš„ï¼Œå¹¶ä¸”ä¸ä¼šæ”¹å˜ã€‚å®ƒæ‰€ä»£è¡¨çš„å«ä¹‰æ˜¯å½“å‰ Hashtable è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œè€Œæ¯ä¸€æ¬¡å»è°ƒç”¨ Hashtable çš„åŒ…æ‹¬ addEntry()ã€remove()ã€rehash() ç­‰æ–¹æ³•ä¸­ï¼Œéƒ½ä¼šä¿®æ”¹ modCount çš„å€¼ã€‚\nCopyOnWriteArrayListé€‚ç”¨åœºæ™¯ï¼šè¯»æ“ä½œå¯ä»¥å°½å¯èƒ½çš„å¿«ï¼Œè€Œå†™å³ä½¿æ…¢ä¸€äº›ä¹Ÿæ²¡å…³ç³»ï¼›è¯»å¤šå†™å°‘ï¼ˆæ¯”å¦‚é»‘åå•ï¼‰\nå½“å®¹å™¨éœ€è¦è¢«ä¿®æ”¹çš„æ—¶å€™ï¼Œä¸ç›´æ¥ä¿®æ”¹å½“å‰å®¹å™¨ï¼Œè€Œæ˜¯å…ˆå°†å½“å‰å®¹å™¨è¿›è¡Œ Copyï¼Œå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œç„¶åä¿®æ”¹æ–°çš„å®¹å™¨ï¼Œå®Œæˆä¿®æ”¹ä¹‹åï¼Œå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨ã€‚è¿™æ ·å°±å®Œæˆäº†æ•´ä¸ªä¿®æ”¹è¿‡ç¨‹ã€‚\nåŒæ ·ï¼Œå…è®¸è¿­ä»£æœŸé—´ä¿®æ”¹ï¼Œä½†æ˜¯è¿­ä»£ä¼šç”¨ä¸€ä¸ªæ—§æ•°ç»„ã€‚\nç¼ºç‚¹ï¼š\n\nå†…å­˜å ç”¨\nå…ƒç´ è¾ƒå¤šæ—¶å¤åˆ¶å¼€é”€å¤§\næ•°æ®ä¸€è‡´æ€§ä¸èƒ½ä¿è¯\n\né˜»å¡é˜Ÿåˆ—é˜»å¡é˜Ÿåˆ—å’Œæ™®é€šé˜Ÿåˆ—çš„åŒºåˆ«åœ¨äºé˜Ÿåˆ—ç©º&#x2F;æ»¡æ—¶çš„å¤„ç†ã€‚\næ™®é€šé˜Ÿåˆ—æ²¡æœ‰å†…ç½®çº¿ç¨‹åŒæ­¥ï¼Œå› æ­¤åœ¨é˜Ÿåˆ—ç©ºæ—¶ï¼Œç§»é™¤å°†è¿”å›nullæˆ–æŠ›å‡ºå¼‚å¸¸ï¼›åœ¨é˜Ÿåˆ—æ»¡æ—¶ï¼ˆå¯¹äºæœ‰ç•Œé˜Ÿåˆ—ï¼‰ï¼Œè°ƒç”¨add()æˆ–offer()æ–¹æ³•å°†æŠ›å‡ºå¼‚å¸¸æˆ–è¿”å›falseï¼Œåœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨éœ€è¦é€šè¿‡ConcurrentLinkedQueueæˆ–è€…Collections.synchronizedListæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚\né˜»å¡é˜Ÿåˆ—å®ç°äº†çº¿ç¨‹å®‰å…¨çš„åŒæ­¥æœºåˆ¶ï¼Œåœ¨é˜Ÿåˆ—ç©ºæ—¶takeä¼šé˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰å¯ç”¨å…ƒç´ ï¼Œé˜Ÿåˆ—æ»¡æ—¶putä¼šé˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—´ã€‚\n\n\nçº¿ç¨‹å®‰å…¨ï¼›2. é˜Ÿåˆ—ç©º&#x2F;æ»¡æ—¶å€™çš„å¤„ç†æ–¹å¼\n\n\nå¸¸ç”¨æ–¹æ³•ï¼š\n\næŠ›å‡ºå¼‚å¸¸ï¼šaddã€removeã€element\nè¿”å›ç»“æœä½†ä¸æŠ›å‡ºå¼‚å¸¸ï¼šofferã€pollã€peek\né˜»å¡ï¼šputã€take\n\nå¸¸è§é˜»å¡é˜Ÿåˆ—ï¼š\n\nArrayBlockingQueueï¼Œæœ‰ç•Œé˜Ÿåˆ—ï¼Œåˆ›å»ºæŒ‡å®šå®¹é‡ï¼Œä¹‹åä¸å¯æ‰©å®¹ã€‚\nå†…éƒ¨æ˜¯ç”¨æ•°ç»„å­˜å‚¨å…ƒç´ çš„ï¼Œåˆ©ç”¨ ReentrantLock å®ç°çº¿ç¨‹å®‰å…¨ã€‚\n\n\nLinkedBlockingQueueï¼Œé“¾è¡¨å®ç°ï¼Œå®¹é‡é»˜è®¤Integer.MAX_VALUE\nSynchronousQueueï¼šå®¹é‡ä¸º0\nPriorityBlockingQueueï¼šæ”¯æŒè‡ªå®šä¹‰ä¼˜å…ˆçº§çš„é˜»å¡é˜Ÿåˆ—\nPriorityBlockingQueue æ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»å®ç° compareTo() æ–¹æ³•æ¥æŒ‡å®šå…ƒç´ æ’åºè§„åˆ™ï¼Œæˆ–è€…åˆå§‹åŒ–æ—¶é€šè¿‡æ„é€ å™¨å‚æ•° Comparator æ¥æŒ‡å®šæ’åºè§„åˆ™ã€‚åŒæ—¶ï¼Œæ’å…¥é˜Ÿåˆ—çš„å¯¹è±¡å¿…é¡»æ˜¯å¯æ¯”è¾ƒå¤§å°çš„ï¼Œä¹Ÿå°±æ˜¯ Comparable çš„ï¼Œå¦åˆ™ä¼šæŠ›å‡º ClassCastException å¼‚å¸¸ã€‚\næ— ç•Œé˜Ÿåˆ—ä¸”æ”¯æŒè‡ªåŠ¨æ‰©å®¹\n\n\nDelayQueueï¼šå…·æœ‰å»¶è¿ŸåŠŸèƒ½ï¼Œæ”¾å…¥çš„å…ƒç´ å¿…é¡»å®ç° Delayed æ¥å£ï¼Œè€Œ Delayed æ¥å£åˆç»§æ‰¿äº† Comparable æ¥å£ï¼Œæ‰€ä»¥è‡ªç„¶å°±æ‹¥æœ‰äº†æ¯”è¾ƒå’Œæ’åºçš„èƒ½åŠ›ã€‚\n\né˜Ÿåˆ—çš„å¹¶å‘åŸç†é˜»å¡é˜Ÿåˆ—ReentrantLock ä»¥åŠå®ƒçš„ Condition æ¥å®ç°ï¼Œè€Œéé˜»å¡é˜Ÿåˆ—ConcurrentLinkedQueueåˆ™æ˜¯åˆ©ç”¨ CAS æ–¹æ³•å®ç°çº¿ç¨‹å®‰å…¨ã€‚\n\nå¦‚æœè¯´ Lock æ˜¯ç”¨æ¥ä»£æ›¿ synchronized çš„ï¼Œé‚£ä¹ˆ Condition å°±æ˜¯ç”¨æ¥ä»£æ›¿ç›¸å¯¹åº”çš„ Object çš„ wait&#x2F;notify&#x2F;notifyAllï¼Œæ‰€ä»¥åœ¨ç”¨æ³•å’Œæ€§è´¨ä¸Šå‡ ä¹éƒ½ä¸€æ ·ã€‚é‚£ä¹ˆsynchronizedé‡Œé¢å¯ä»¥ç”¨Conditionæ›¿ä»£Objectå—ï¼Ÿæˆ‘çŸ¥é“åä¹‹ä¸å¯ä»¥\n\n3. åŸå­ç±»åŸå­æ€§ï¼šæ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸èƒ½ä¹‹æ“ä½œæˆåŠŸå…¶ä¸­æŸä¸€éƒ¨åˆ†\nåŸå­ç±»ä¸é”çš„ä½œç”¨åŒºåˆ«ï¼š\n\nç²’åº¦æ›´ç»†ï¼šç«äº‰è¢«ç¼©å°åˆ°å˜é‡çº§åˆ«\næ•ˆç‡æ›´é«˜ï¼šå› ä¸ºä½¿ç”¨CASï¼Œä¸é˜»å¡çº¿ç¨‹(éé«˜å¹¶å‘æƒ…å†µ)\nåŸå­ç±»ä½¿ç”¨CASï¼Œæ ¹æ®JMMï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œflushï¼ˆæ•°æ®ä¿®æ”¹åå°†å…¶åˆ·æ–°åˆ°ä¸»å­˜ï¼‰ã€refreshï¼ˆä»ä¸»å­˜è¯»å–æœ€æ–°æ•°æ®åˆ°ç¼“å­˜ï¼‰ï¼Œå› æ­¤ä¼šå¸¦æ¥ä¸€å®šæ¶ˆè€—\né”è™½ç„¶é¿å…äº†é¢‘ç¹ç¼“å­˜æ“ä½œï¼ˆï¼Œé€šè¿‡monitoræˆ–è€…aqså®ç°çº¿ç¨‹åŒæ­¥ï¼Œç«äº‰é”å¤±è´¥ä¼šè¢«é˜»å¡ï¼‰ï¼Œä½†æ˜¯ä¼šå¯¼è‡´é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\n\n\n\nåº•å±‚ï¼šUnSafeç±»æ¥å®ç°ï¼ŒUnsafeçš„getAndAddIntæ˜¯é€šè¿‡å¾ªç¯ + CAS çš„æ–¹å¼æ¥å®ç°çš„ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šé€šè¿‡ compareAndSwapInt æ–¹æ³•æ¥å°è¯•æ›´æ–° value çš„å€¼ï¼Œå¦‚æœæ›´æ–°å¤±è´¥å°±é‡æ–°è·å–ï¼Œç„¶åå†æ¬¡å°è¯•æ›´æ–°ï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚\nåŸå­ç±»åˆ†ç±»\nåŸºæœ¬åŸå­ç±» Atomicï¼šAtomicIntegerã€AtomicLongã€AtomicBoolean\n\næ•°ç»„åŸå­ç±» Atomic*Arrayï¼šAtomicIntegerArrayã€AtomicLongArrayã€AtomicReferenceArrayï¼ˆå¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»ï¼‰\n\nå¼•ç”¨åŸå­ç±» ï¼šAtomicReferenceã€AtomicStampedReferenceï¼ˆåŠ ä¸Šæ—¶é—´æˆ³ï¼Œè§£å†³ABAé—®é¢˜ï¼‰ã€AtomicMarkableReferenceï¼ˆä¸AtomicReferenceç±»ä¼¼ï¼ŒåŠ ä¸Šäº†å¸ƒå°”å€¼ï¼Œå¯ä»¥è¡¨ç¤ºè¯¥å¯¹è±¡å·²åˆ é™¤ï¼‰\n\nåŸå­æ›´æ–°å™¨ï¼šAtomicIntegerFieldUpdaterã€AtomicLongFieldUpdaterã€AtomicReferenceFieldUpdaterï¼ˆå¯¹äºä¹‹å‰å·²ç»å®šä¹‰çš„å˜é‡è¿›è¡Œå‡çº§ï¼Œå®è´¨é€šè¿‡CASå…·æœ‰åŸå­æ€§ï¼Œé€‚åˆåªåœ¨å°‘æ•°å®šæ—¶çš„æ—¶å€™éœ€è¦åŸå­æ€§çš„å˜é‡ï¼‰\n\nåŠ æ³•å™¨ï¼šLongAdderã€DoubleAdder\n\nåŠ æ³•å™¨çš„ä½œç”¨\næ˜¯é’ˆå¯¹åŸºæœ¬åŸå­ç±»çš„å‡çº§ï¼Œå†…éƒ¨æœ‰baseå’ŒCell[]æ•°ç»„\nç«äº‰ä¸æ¿€çƒˆç›´æ¥åœ¨baseå˜é‡ç´¯åŠ ï¼›\næ¿€çƒˆç”¨Cell[]æ•°ç»„ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šåˆ†æ•£ç§¯ç´¯å¯¼å„è‡ªå¯¹åº”çš„Cell[]æ•°ç»„ä¸­çš„æŸä¸ªå¯¹è±¡ï¼Œè€Œä¸ä¼šå…±ç”¨ä¸€ä¸ªï¼Œé™ä½å†²çªæ¦‚ç‡ï¼ˆé€šè¿‡åˆ†æ®µæé«˜å¹¶å‘æ€§ï¼Œç±»ä¼¼JAVA7çš„ConcurrentHashMapä¸­16ä¸ªSegmentï¼‰\næœ€ç»ˆé€šè¿‡sumæ–¹æ³•å®ç°å¤šçº¿ç¨‹è®¡æ•°ï¼Œæ‰§è¡Œæ—¶ä¼šå°†å„çº¿ç¨‹Cellç›¸åŠ åŠ ä¸Šbaseå¾—åˆ°æ€»å’Œã€‚\n\n\nå¦‚ä½•é€‰æ‹©AtomicIntegerè¿˜æ˜¯LongAdderï¼Ÿ\n\nä½ç«äº‰æ—¶ååé‡ç›¸ä¼¼ï¼Œç«äº‰æ¿€çƒˆæ—¶LongAdderååé‡é«˜ï¼Œä½†å†…å­˜æ¶ˆè€—å¤§\nLongAdderæ›¿ä»£ä¸äº†AtomicInteger\nLongAdderåªæä¾›äº†addã€incrementç­‰ç®€å•æ–¹æ³•ï¼Œé€‚åˆç»Ÿè®¡æŠ€æœ¯æ±‚å’Œåœºæ™¯\nAtomicLongè¿˜æä¾›äº†compareAndSetï¼Œé€‚åˆåŠ å‡ä¹‹å¤–çš„æ›´å¤æ‚çš„éœ€è¦CASçš„åœºæ™¯\n\n\n\n\n\nç§¯ç´¯å™¨ï¼šLongAccumulatorã€DoubleAccumulator\n\n\nå®é™…ä¸Š Accumulator å°±æ˜¯ä¸€ä¸ªæ›´é€šç”¨ç‰ˆæœ¬çš„ Adderï¼Œæ¯”å¦‚ LongAccumulator æ˜¯ LongAdder çš„åŠŸèƒ½å¢å¼ºç‰ˆï¼Œå› ä¸º LongAdder çš„ API åªæœ‰å¯¹æ•°å€¼çš„åŠ å‡ï¼Œè€Œ LongAccumulator æä¾›äº†è‡ªå®šä¹‰çš„å‡½æ•°æ“ä½œã€‚\nå¤§é‡å¹¶è¡Œè®¡ç®—ï¼Œå¹¶ä¸”è®¡ç®—é¡ºåºä¸é‡è¦ï¼Œæ¯”å¦‚åŠ æ³•ã€ä¹˜æ³•ï¼Œå¯ä»¥ä½¿ç”¨\nåŸå­ç±»å’Œvolatileå¼‚åŒ\nvolatileæ˜¯ç”¨äºä¿è¯å¯è§æ€§çš„ï¼ŒåŠ ä¸Šä¹‹åå°±ä¼šé€šè¿‡flushå’Œrefreshæ“ä½œæ¥è§£å†³å¯è§æ€§ã€‚\nä»…ä»…é€šè¿‡volatileä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºä¸æ˜¯åŸå­çš„ï¼ˆåŸå­ç±»é€šè¿‡CASå®ç°äº†åŸå­æ€§ï¼‰\nåŸå­ç±»å¯ä»¥ä¿è¯å¯è§æ€§\n\nåŸå­ç±»å’ŒSychronizedå¼‚åŒ\nåŸç†ä¸åŒï¼šmonitor vs CAS ä¹è§‚é”å’Œæ‚²è§‚é”\n\nå› ä¸ºæ‚²è§‚é”çš„å¼€é”€æ˜¯å›ºå®šçš„ï¼Œä¹Ÿæ˜¯ä¸€åŠ³æ°¸é€¸çš„ã€‚éšç€æ—¶é—´çš„å¢åŠ ï¼Œè¿™ç§å¼€é”€å¹¶ä¸ä¼šçº¿æ€§å¢é•¿ã€‚\nè€Œä¹è§‚é”è™½ç„¶åœ¨çŸ­æœŸå†…çš„å¼€é”€ä¸å¤§ï¼Œä½†æ˜¯éšç€æ—¶é—´çš„å¢åŠ ï¼Œå®ƒçš„å¼€é”€ä¹Ÿæ˜¯é€æ­¥ä¸Šæ¶¨çš„ã€‚\n\n\n\né€‚ç”¨èŒƒå›´ï¼šåŸå­ç±»åªé’ˆå¯¹ä¸€ä¸ªå¯¹è±¡, synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•å’Œä»£ç å—\n\nç²’åº¦ï¼šåŸå­ç±»ç²’åº¦å°ï¼Œsychronizedç²’åº¦å¤§\n\næ€§èƒ½ï¼šç«äº‰æ¿€çƒˆsychronized,ä¸æ¿€çƒˆåŸå­ç±»\n\n\n4. ThreadLocalThreadLocalMapåŸç†ï¼Ÿä¸ºä»€ä¹ˆkeyè¦å¼±å¼•ç”¨ï¼Ÿ\næ¯ä¸ªThreadä¸­éƒ½æœ‰ä¸€ä¸ªThreadLocalMapï¼Œkeyä¸ºThreadLocalï¼Œæ¯æ¬¡è·å–ThreadLocalæ—¶éƒ½ä¼šä»å½“å‰çº¿ç¨‹è¿™ä¸ªmapå»è·å–ï¼Œå› æ­¤å³ä¾¿æ˜¯åŒä¸€ä¸ªThrealLocalå¯¹è±¡ä¹Ÿèƒ½å¾—åˆ°ä¸åŒçš„å€¼ï¼Œå®ç°çº¿ç¨‹éš”ç¦»ã€‚\nä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¼±å¼•ç”¨ï¼Ÿå› ä¸ºå½“ThreadLocalæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨æ—¶ï¼Œåº”å½“è¢«GCå›æ”¶ï¼Œä½¿ç”¨å¼±å¼•ç”¨å°±èƒ½è®©GCå›æ”¶æ‰ï¼Œé¿å…keyæ®‹ç•™åœ¨ThreadLocalMapä¸­ï¼ˆçº¿ç¨‹mapä¸­çš„entryå¼ºå¼•ç”¨å°±ä¼šä¸€ç›´ç•™ç€ï¼‰ã€‚removeå°±æ˜¯ä¸ºäº†é˜²æ­¢å½“ThreadLocalçš„é”®è¢«å›æ”¶ï¼Œvalueå¼ºå¼•ç”¨ä¾æ—§å­˜åœ¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚JDK8ä¹‹åï¼Œgetå’Œsetå·²ç»åŠ å…¥äº†è‡ªåŠ¨æ¸…ç†æœºåˆ¶ï¼Œä¼šè®²keyä¸ºnullçš„ç§»é™¤ï¼Œä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹é•¿æœŸä¸è®¿é—®ThreadLocalå˜é‡ï¼Œä¹Ÿä¸ä¼šè§¦å‘ï¼Œå› æ­¤removeä¾ç„¶æ˜¯ä¿è¯å†…å­˜å®‰å…¨çš„å…³é”®æ­¥éª¤ã€‚\n\n\nThreadLocalMap è§£å†³ hash å†²çªçš„æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒé‡‡ç”¨çš„æ˜¯çº¿æ€§æ¢æµ‹æ³•ã€‚å¦‚æœå‘ç”Ÿå†²çªï¼Œå¹¶ä¸ä¼šç”¨é“¾è¡¨çš„å½¢å¼å¾€ä¸‹é“¾ï¼Œè€Œæ˜¯ä¼šç»§ç»­å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºçš„æ ¼å­ã€‚è¿™æ˜¯ ThreadLocalMap å’Œ HashMap åœ¨å¤„ç†å†²çªæ—¶ä¸ä¸€æ ·çš„ç‚¹ã€‚\n\né€‚ç”¨åœºæ™¯ï¼š\n\næ¯ä¸ªçº¿ç¨‹ç‹¬äº«çš„å¯¹è±¡ï¼šæ¯ä¸ªçº¿ç¨‹éœ€è¦ä¸€ä¸ªå•ç‹¬çš„ï¼Œçº¿ç¨‹ä¹‹é—´ä¸èƒ½å…±ç”¨ï¼Œä½†ä¸åœ¨ä»»åŠ¡ä¸­åˆ›å»ºï¼Œä¼šé€ æˆæµªè´¹ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ThreadLocalä¸ºæ¯ä¸ªçº¿ç¨‹å­˜ä¸€ä¸ªå°±è¡Œã€‚\nçº¿ç¨‹å†…éœ€è¦ç‹¬ç«‹ä¿å­˜ä¿¡æ¯ï¼Œä»¥ä¾¿ä¾›å…¶ä»–æ–¹æ³•æ›´æ–¹ä¾¿åœ°è·å–è¯¥ä¿¡æ¯çš„åœºæ™¯ï¼šæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€‚å‰é¢æ‰§è¡Œçš„æ–¹æ³•è®¾ç½®äº†ä¿¡æ¯åï¼Œåç»­æ–¹æ³•å¯ä»¥é€šè¿‡ ThreadLocal ç›´æ¥è·å–åˆ°ï¼Œé¿å…äº†ä¼ å‚ã€‚\n\nThreadLocalä¸æ˜¯ç”¨æ¥è§£å†³å…±äº«èµ„æºé—®é¢˜çš„\nThreadLocal ç¡®å®å¯ä»¥ç”¨äºè§£å†³å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†å…¶èµ„æºå¹¶ä¸æ˜¯å…±äº«çš„ï¼Œè€Œæ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬äº«çš„ã€‚\n\nThreadLocal å’Œ synchronized æ˜¯ä»€ä¹ˆå…³ç³»\nThreadLocal æ˜¯é€šè¿‡è®©æ¯ä¸ªçº¿ç¨‹ç‹¬äº«è‡ªå·±çš„å‰¯æœ¬ï¼Œé¿å…äº†èµ„æºçš„ç«äº‰ã€‚\nsynchronized ä¸»è¦ç”¨äºä¸´ç•Œèµ„æºçš„åˆ†é…ï¼Œåœ¨åŒä¸€æ—¶åˆ»é™åˆ¶æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®è¯¥èµ„æºã€‚\n\n5. å·¥å…·ç±»Semaphoreï¼šé™åˆ¶å¹¶å‘ğŸ“š\nCompletableFutureã€CountDownLatchï¼šç»Ÿä¸€ç»“æŸæ—¶é—´\nCountDownLatchï¼š\n\nä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–å¤šä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œå†ç»§ç»­è‡ªå·±çš„å·¥ä½œï¼Œåˆå§‹å€¼ä¸ºå¤šä¸ª\n\nå¤šä¸ªçº¿ç¨‹ç­‰å¾…æŸä¸€ä¸ªçº¿ç¨‹çš„ä¿¡å·ï¼ŒåŒæ—¶å¼€å§‹æ‰§è¡Œï¼Œåˆå§‹å€¼ä¸º1ä¸ª\n\n\nCyclicBarrierï¼šå¯ä»¥æ„é€ å‡ºä¸€ä¸ªé›†ç»“ç‚¹ï¼Œå½“æŸä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ await() çš„æ—¶å€™ï¼Œå®ƒå°±ä¼šåˆ°è¿™ä¸ªé›†ç»“ç‚¹å¼€å§‹ç­‰å¾…ï¼Œç­‰å¾…è¿™ä¸ªæ …æ è¢«æ’¤é”€ã€‚ç›´åˆ°é¢„å®šæ•°é‡çš„çº¿ç¨‹éƒ½åˆ°äº†è¿™ä¸ªé›†ç»“ç‚¹ä¹‹åï¼Œè¿™ä¸ªæ …æ å°±ä¼šè¢«æ’¤é”€ï¼Œä¹‹å‰ç­‰å¾…çš„çº¿ç¨‹å°±åœ¨æ­¤åˆ»ç»Ÿä¸€å‡ºå‘ï¼Œç»§ç»­å»æ‰§è¡Œå‰©ä¸‹çš„ä»»åŠ¡ã€‚\nCyclicBarrier å’Œ CountDownLatch æœ‰ä»€ä¹ˆå¼‚åŒã€‚\nç›¸åŒç‚¹ï¼šéƒ½èƒ½é˜»å¡ä¸€ä¸ªæˆ–ä¸€ç»„çº¿ç¨‹ï¼Œç›´åˆ°æŸä¸ªé¢„è®¾çš„æ¡ä»¶è¾¾æˆå‘ç”Ÿï¼Œå†ç»Ÿä¸€å‡ºå‘ã€‚\nä½†æ˜¯å®ƒä»¬ä¹Ÿæœ‰å¾ˆå¤šä¸åŒç‚¹ï¼Œå…·ä½“å¦‚ä¸‹ã€‚\n\nä½œç”¨å¯¹è±¡ä¸åŒï¼šCyclicBarrier è¦ç­‰å›ºå®šæ•°é‡çš„çº¿ç¨‹éƒ½åˆ°è¾¾äº†æ …æ ä½ç½®æ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œè€Œ CountDownLatch åªéœ€ç­‰å¾…æ•°å­—å€’æ•°åˆ° 0ï¼Œä¹Ÿå°±æ˜¯è¯´ CountDownLatch ä½œç”¨äºäº‹ä»¶ï¼Œä½† CyclicBarrier ä½œç”¨äºçº¿ç¨‹ï¼›CountDownLatch æ˜¯åœ¨è°ƒç”¨äº† countDown æ–¹æ³•ä¹‹åæŠŠæ•°å­—å€’æ•°å‡ 1ï¼Œè€Œ CyclicBarrier æ˜¯åœ¨æŸçº¿ç¨‹å¼€å§‹ç­‰å¾…åæŠŠè®¡æ•°å‡ 1ã€‚\nå¯é‡ç”¨æ€§ä¸åŒï¼šCountDownLatch åœ¨å€’æ•°åˆ° 0 å¹¶ä¸”è§¦å‘é—¨é—©æ‰“å¼€åï¼Œå°±ä¸èƒ½å†æ¬¡ä½¿ç”¨äº†ï¼Œé™¤éæ–°å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼›è€Œ CyclicBarrier å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œåœ¨åˆšæ‰çš„ä»£ç ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæ¯ 3 ä¸ªåŒå­¦åˆ°äº†ä¹‹åéƒ½èƒ½å‡ºå‘ï¼Œå¹¶ä¸éœ€è¦é‡æ–°æ–°å»ºå®ä¾‹ã€‚CyclicBarrier è¿˜å¯ä»¥éšæ—¶è°ƒç”¨ reset æ–¹æ³•è¿›è¡Œé‡ç½®ï¼Œå¦‚æœé‡ç½®æ—¶æœ‰çº¿ç¨‹å·²ç»è°ƒç”¨äº† await æ–¹æ³•å¹¶å¼€å§‹ç­‰å¾…ï¼Œé‚£ä¹ˆè¿™äº›çº¿ç¨‹åˆ™ä¼šæŠ›å‡º BrokenBarrierException å¼‚å¸¸ã€‚\næ‰§è¡ŒåŠ¨ä½œä¸åŒï¼šCyclicBarrier æœ‰æ‰§è¡ŒåŠ¨ä½œ barrierActionï¼Œè€Œ CountDownLatch æ²¡è¿™ä¸ªåŠŸèƒ½ã€‚\n\n6. JMM Javaå†…å­˜æ¨¡å‹\nJVMå†…å­˜ç»“æ„æ˜¯Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶åŒºåŸŸ\nJMMæ˜¯Javaå†…å­˜æ¨¡å‹ï¼Œä¸Javaå¹¶å‘ç¼–ç¨‹æœ‰å…³\n\nJMM\nJMM æ˜¯å’Œå¤šçº¿ç¨‹ç›¸å…³çš„ä¸€ç»„è§„èŒƒï¼Œéœ€è¦å„ä¸ª JVM çš„å®ç°æ¥éµå®ˆ JMM è§„èŒƒï¼Œä»¥ä¾¿äºå¼€å‘è€…å¯ä»¥åˆ©ç”¨è¿™äº›è§„èŒƒï¼Œæ›´æ–¹ä¾¿åœ°å¼€å‘å¤šçº¿ç¨‹ç¨‹åºã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä¾¿åŒä¸€ä¸ªç¨‹åºåœ¨ä¸åŒçš„è™šæ‹Ÿæœºä¸Šè¿è¡Œï¼Œå¾—åˆ°çš„ç¨‹åºç»“æœä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚\nJMMå±è”½äº†å¤šçº§ç¼“å­˜ï¼Œå®šä¹‰äº†ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„æ¦‚å¿µï¼Œç”±JMMæ§åˆ¶æœŸé—´é€šä¿¡ã€‚\n\næ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼ŒåŒæ—¶æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å·¥ä½œå†…å­˜ï¼Œè€Œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡çš„å†…å®¹æ˜¯ä¸»å†…å­˜ä¸­è¯¥å˜é‡çš„æ‹·è´ï¼›\nçº¿ç¨‹ä¸èƒ½ç›´æ¥è¯» &#x2F; å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œä½†å¯ä»¥æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œç„¶åå†åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œè¿™æ ·ï¼Œå…¶ä»–çº¿ç¨‹å°±å¯ä»¥çœ‹åˆ°æœ¬æ¬¡ä¿®æ”¹ï¼›\nä¸»å†…å­˜æ˜¯ç”±å¤šä¸ªçº¿ç¨‹æ‰€å…±äº«çš„ï¼Œä½†çº¿ç¨‹é—´ä¸å…±äº«å„è‡ªçš„å·¥ä½œå†…å­˜ï¼Œå¦‚æœçº¿ç¨‹é—´éœ€è¦é€šä¿¡ï¼Œåˆ™å¿…é¡»å€ŸåŠ©ä¸»å†…å­˜ä¸­è½¬æ¥å®Œæˆã€‚\n\næŒ‡ä»¤é‡æ’åºï¼šé‡æ’åºé€šè¿‡å‡å°‘æ‰§è¡ŒæŒ‡ä»¤ï¼Œä»è€Œæé«˜æ•´ä½“çš„è¿è¡Œé€Ÿåº¦ï¼Œè¿™å°±æ˜¯é‡æ’åºå¸¦æ¥çš„ä¼˜åŒ–å’Œå¥½å¤„ã€‚\n\nç¼–è¯‘å™¨ä¼˜åŒ–\nCPUé‡æ’åº\nå†…å­˜â€œé‡æ’åºâ€\n\nåŸå­æ€§ï¼šåœ¨ç¼–ç¨‹ä¸­ï¼Œå…·å¤‡åŸå­æ€§çš„æ“ä½œè¢«ç§°ä¸ºåŸå­æ“ä½œã€‚åŸå­æ“ä½œæ˜¯æŒ‡ä¸€ç³»åˆ—çš„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å‘ç”Ÿï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å‘ç”Ÿï¼Œä¸ä¼šå‡ºç°æ‰§è¡Œä¸€åŠå°±ç»ˆæ­¢çš„æƒ…å†µã€‚\nå†…å­˜å¯è§æ€§ï¼šå› ä¸ºå¤šçº§ç¼“å­˜å¼•èµ·ï¼Œæ¯ä¸ªCPUè·å–æ•°æ®ï¼Œä¼šå°†æ•°æ®ä»å†…å­˜ä¸€å±‚å±‚å¾€ä¸Šè¯»å–ï¼ŒåŒæ ·ï¼Œåç»­å¯¹äºæ•°æ®çš„ä¿®æ”¹ä¹Ÿæ˜¯å…ˆå†™å…¥åˆ°è‡ªå·±çš„ L1 ç¼“å­˜ä¸­ï¼Œç„¶åç­‰å¾…æ—¶æœºå†é€å±‚å¾€ä¸‹åŒæ­¥ï¼Œç›´åˆ°æœ€ç»ˆåˆ·å›å†…å­˜ã€‚volatileï¼šå¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œ happen-before åé¢å¯¹è¯¥å˜é‡çš„è¯»æ“ä½œã€‚\nsynchronized ä¸ä»…ä¿è¯äº†åŸå­æ€§ï¼Œè¿˜ä¿è¯äº†å¯è§æ€§synchronized ä¸ä»…ä¿è¯äº†ä¸´ç•ŒåŒºå†…æœ€å¤šåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ“ä½œï¼ŒåŒæ—¶è¿˜ä¿è¯äº†åœ¨å‰ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œä¹‹å‰æ‰€åšçš„æ‰€æœ‰ä¿®æ”¹ï¼Œéƒ½èƒ½è¢«è·å¾—åŒä¸€ä¸ªé”çš„ä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰€çœ‹åˆ°ï¼Œä¹Ÿå°±æ˜¯èƒ½è¯»å–åˆ°æœ€æ–°çš„å€¼ã€‚å› ä¸ºå¦‚æœå…¶ä»–çº¿ç¨‹çœ‹ä¸åˆ°ä¹‹å‰æ‰€åšçš„ä¿®æ”¹ï¼Œä¾ç„¶ä¹Ÿä¼šå‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\n"}]